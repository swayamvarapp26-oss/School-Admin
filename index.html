 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCHOOL ADMIN - Management Portal</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --primary-dark: #1a252f;
            --secondary: #3498db;
            --secondary-dark: #2980b9;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light-gray: #bdc3c7;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 32px;
            color: var(--secondary);
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .logo span {
            color: var(--secondary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: white;
            object-fit: cover;
        }

        .user-details h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .user-details p {
            font-size: 14px;
            color: var(--light-gray);
        }

        .logout-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Main Container */
        .container {
            display: flex;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: white;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.05);
            padding: 30px 0;
            transition: var(--transition);
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 5px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 18px 30px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            border-left: 5px solid transparent;
            font-weight: 500;
        }

        .nav-links a:hover, .nav-links a.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            border-left: 5px solid var(--secondary);
        }

        .nav-links i {
            font-size: 20px;
            margin-right: 15px;
            width: 25px;
        }

        .nav-count {
            background-color: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: auto;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dashboard-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }

        .card-notices::before { background: linear-gradient(90deg, #3498db, #2ecc71); }
        .card-teachers::before { background: linear-gradient(90deg, #9b59b6, #e74c3c); }
        .card-students::before { background: linear-gradient(90deg, #f39c12, #d35400); }
        .card-admins::before { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .card-developer::before { background: linear-gradient(90deg, #8e44ad, #3498db); }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 30px;
            color: white;
        }

        .card-notices .card-icon { background: linear-gradient(135deg, #3498db, #2ecc71); }
        .card-teachers .card-icon { background: linear-gradient(135deg, #9b59b6, #e74c3c); }
        .card-students .card-icon { background: linear-gradient(135deg, #f39c12, #d35400); }
        .card-admins .card-icon { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .card-developer .card-icon { background: linear-gradient(135deg, #8e44ad, #3498db); }

        .dashboard-card h3 {
            font-size: 16px;
            color: var(--gray);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .dashboard-card .number {
            font-size: 36px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .dashboard-card .trend {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--gray);
        }

        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        /* Content Sections */
        .content-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .section-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header h2 i {
            color: var(--secondary);
        }

        /* Forms */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--secondary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: var(--light-gray);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-block {
            width: 100%;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--light);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background-color: var(--primary);
            color: white;
        }

        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 16px;
        }

        tbody tr {
            border-bottom: 1px solid var(--light);
            transition: var(--transition);
        }

        tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        td {
            padding: 18px 15px;
            color: var(--dark);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        /* Priority Badges */
        .priority-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        .priority-high { background-color: rgba(231, 76, 60, 0.1); color: #e74c3c; }
        .priority-medium { background-color: rgba(243, 156, 18, 0.1); color: #f39c12; }
        .priority-low { background-color: rgba(52, 152, 219, 0.1); color: #3498db; }

        /* Call Button */
        .call-btn {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            transition: var(--transition);
        }

        .call-btn:hover {
            background-color: rgba(46, 204, 113, 0.2);
            color: #219653;
        }

        /* Auth Screens */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .auth-box {
            background-color: white;
            border-radius: 20px;
            padding: 50px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 0.8s ease;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .auth-logo i {
            font-size: 42px;
            color: var(--secondary);
        }

        .auth-logo h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 14px;
        }

        /* OTP Input Container */
        .otp-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .otp-input {
            width: 45px !important;
            height: 45px !important;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            transition: var(--transition);
        }

        .otp-input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        /* Password Requirements */
        .password-requirements {
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 14px;
        }

        .password-requirements h4 {
            margin-bottom: 8px;
            color: var(--dark);
        }

        .password-requirements ul {
            list-style: none;
            padding-left: 5px;
        }

        .password-requirements li {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-requirements li i {
            font-size: 12px;
            width: 16px;
        }

        .requirement-met {
            color: var(--success);
        }

        .requirement-not-met {
            color: var(--danger);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: slideInUp 0.4s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light);
        }

        .modal-header h3 {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Admin Profile Images */
        .admin-profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--light);
        }

        .admin-profile-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--secondary);
            margin: 0 auto 20px;
            display: block;
        }

        /* Developer Data Specific Styles */
        .developer-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .developer-form {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--light);
        }

        .link-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--light);
            transition: var(--transition);
        }

        .link-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .link-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .link-description {
            color: var(--gray);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .link-url {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            margin-top: 10px;
            transition: var(--transition);
        }

        .link-url:hover {
            background: rgba(52, 152, 219, 0.2);
            text-decoration: underline;
        }

        .link-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        .category-general { background: rgba(52, 152, 219, 0.1); color: #2980b9; }
        .category-important { background: rgba(231, 76, 60, 0.1); color: #c0392b; }
        .category-resource { background: rgba(46, 204, 113, 0.1); color: #27ae60; }
        .category-tutorial { background: rgba(155, 89, 182, 0.1); color: #8e44ad; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.5); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Success Message */
        #successMessage {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            max-width: 350px;
        }

        #errorMessage {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--danger);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            max-width: 350px;
        }

        /* Approval badge styles */
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-pending { 
            background-color: rgba(243, 156, 18, 0.1); 
            color: #f39c12; 
        }
        
        .status-approved { 
            background-color: rgba(46, 204, 113, 0.1); 
            color: #27ae60; 
        }
        
        .status-rejected { 
            background-color: rgba(231, 76, 60, 0.1); 
            color: #e74c3c; 
        }
        
        .approval-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .approve-btn {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .approve-btn:hover {
            background-color: rgba(46, 204, 113, 0.2);
        }
        
        .reject-btn {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .reject-btn:hover {
            background-color: rgba(231, 76, 60, 0.2);
        }
        
        .view-btn {
            background-color: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .view-btn:hover {
            background-color: rgba(52, 152, 219, 0.2);
        }

        .btn.active {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
            border: none;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
        }

        /* Admin status badges */
        .status-active { 
            background-color: rgba(46, 204, 113, 0.1); 
            color: #27ae60; 
        }
        
        .status-inactive { 
            background-color: rgba(231, 76, 60, 0.1); 
            color: #e74c3c; 
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
        }

        /* Error Message in Forgot Password */
        .email-not-registered {
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        /* Profile Image Container */
        .profile-image-container {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
        }

        .profile-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-image-container i {
            font-size: 20px;
            color: white;
        }

        .profile-large-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            border: 4px solid var(--secondary);
            margin: 0 auto 20px;
        }

        .profile-large-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-large-container i {
            font-size: 48px;
            color: white;
        }

        /* Simple Forgot Password Button */
        .simple-forgot-btn {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            text-align: right;
            width: 100%;
            transition: var(--transition);
        }
        
        .simple-forgot-btn:hover {
            color: var(--secondary-dark);
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 20px 0;
            }
            
            .nav-links {
                display: flex;
                overflow-x: auto;
            }
            
            .nav-links li {
                flex-shrink: 0;
            }
            
            .nav-links a {
                border-left: none;
                border-bottom: 3px solid transparent;
                padding: 15px 20px;
            }
            
            .nav-links a:hover, .nav-links a.active {
                border-left: none;
                border-bottom: 3px solid var(--secondary);
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .auth-box {
                padding: 30px;
            }
            
            .modal-content {
                padding: 30px 20px;
            }
        }
        
        /* Activity Log Styles */
        .activity-status-completed {
            color: var(--success);
            font-weight: 600;
        }
        
        .activity-status-failed {
            color: var(--danger);
            font-weight: 600;
        }
        
        .activity-status-pending {
            color: var(--warning);
            font-weight: 600;
        }
        
        .activity-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .no-activities {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .no-activities i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Auth Screens -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-user-shield"></i>
                    <h1>SCHOOL <span>ADMIN</span></h1>
                </div>
                <p>School Administration Management Portal</p>
            </div>
            
            <!-- Auth Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="forgot">Forgot Password</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginTab" class="auth-tab-content active">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="admin@school.com" value="vijaygond2024@gmail.com">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter password" value="admin123">
                </div>
                
                <!-- Simple Forgot Password Button -->
                <button class="simple-forgot-btn" id="simpleForgotBtn">
                    <i class="fas fa-key"></i> Forgot Password?
                </button>
                
                <button class="btn btn-primary btn-block" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Login to Admin Panel
                </button>
                
                <div class="auth-footer">
                    <p>Admin: vijaygond2024@gmail.com / admin123</p>
                </div>
            </div>
            
            <!-- Forgot Password Form -->
            <div id="forgotTab" class="auth-tab-content" style="display: none;">
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="forgotEmail" class="form-control" placeholder="admin@school.com">
                </div>
                
                <button class="btn btn-warning btn-block" id="sendResetOtpBtn">
                    <i class="fas fa-key"></i> Send Reset OTP
                </button>
                
                <div class="form-group" id="resetOtpSection" style="display: none;">
                    <label>Enter OTP *</label>
                    <div class="otp-container">
                        <input type="text" class="otp-input" maxlength="1" data-index="0">
                        <input type="text" class="otp-input" maxlength="1" data-index="1">
                        <input type="text" class="otp-input" maxlength="1" data-index="2">
                        <input type="text" class="otp-input" maxlength="1" data-index="3">
                        <input type="text" class="otp-input" maxlength="1" data-index="4">
                        <input type="text" class="otp-input" maxlength="1" data-index="5">
                    </div>
                </div>
                
                <!-- VERIFY OTP BUTTON -->
                <button class="btn btn-primary btn-block" id="verifyOtpBtn" style="display: none; margin-top: 20px;">
                    <i class="fas fa-check"></i> Verify OTP
                </button>
                
                <!-- NEW PASSWORD FIELDS -->
                <div id="newPasswordFields" style="display: none;">
                    <div class="form-group">
                        <label>New Password *</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="Enter new password">
                        <div class="password-requirements">
                            <h4>Password Requirements:</h4>
                            <ul>
                                <li id="forgotReqLength">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    At least 6 characters
                                </li>
                                <li id="forgotReqLowercase">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains lowercase letter
                                </li>
                                <li id="forgotReqUppercase">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains uppercase letter
                                </li>
                                <li id="forgotReqNumber">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains number
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Confirm New Password *</label>
                        <input type="password" id="confirmNewPassword" class="form-control" placeholder="Confirm new password">
                    </div>
                    
                    <!-- CHANGE PASSWORD BUTTON - Initially hidden -->
                    <button class="btn btn-primary btn-block" id="resetPasswordBtn" style="display: none; margin-top: 20px;">
                        <i class="fas fa-sync-alt"></i> Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Admin Panel -->
    <div id="adminPanel" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <h1>SCHOOL <span>ADMIN</span></h1>
            </div>
            
            <div class="user-info">
                <div class="profile-image-container" id="adminAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <h3 id="adminName">VIJAY KUMAR</h3>
                    <p id="adminEmail">vijaygond2024@gmail.com</p>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>
        
        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <ul class="nav-links">
                    <li>
                        <a href="#" class="active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="sendNotice">
                            <i class="fas fa-bullhorn"></i>
                            <span>Send Notice</span>
                            <span class="nav-count" id="noticeCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="manageNotices">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Manage Notices</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="manageTeachers">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Manage Teachers</span>
                            <span class="nav-count" id="teacherCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="manageStudents">
                            <i class="fas fa-user-graduate"></i>
                            <span>Manage Students</span>
                            <span class="nav-count" id="studentCount">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="manageAdmins">
                            <i class="fas fa-user-shield"></i>
                            <span>Manage Admins</span>
                            <span class="nav-count" id="adminCount">0</span>
                        </a>
                    </li>
                    <!-- NEW DEVELOPER OPTION -->
                    <li>
                        <a href="#" data-section="developer">
                            <i class="fas fa-code"></i>
                            <span>Developer</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </aside>
            
            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Section -->
                <div class="content-section active" id="dashboardSection">
                    <div class="section-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
                        <p id="currentDate">Loading date...</p>
                    </div>
                    
                    <div class="dashboard-cards">
                        <div class="dashboard-card card-notices">
                            <div class="card-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <h3>Total Notices</h3>
                            <div class="number" id="totalNoticesCount">0</div>
                            <div class="trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="noticesTrend">0 sent this week</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card card-teachers">
                            <div class="card-icon">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <h3>Approved Teachers</h3>
                            <div class="number" id="totalTeachersCount">0</div>
                            <div class="trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="teachersTrend">0 new this month</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card card-students">
                            <div class="card-icon">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <h3>Students (App Users)</h3>
                            <div class="number" id="totalStudentsCount">0</div>
                            <div class="trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="studentsTrend">0 active today</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card card-developer">
                            <div class="card-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <h3>Developer Data</h3>
                            <div class="number" id="totalDeveloperDataCount">0</div>
                            <div class="trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Manage text & links</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-header">
                        <h2><i class="fas fa-history"></i> Recent Activity</h2>
                        <div class="activity-actions">
                            <button class="btn btn-secondary btn-sm" id="refreshActivityBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-danger btn-sm" id="clearActivityBtn">
                                <i class="fas fa-trash"></i> Clear All
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Activity</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="activityLog">
                                <!-- Activity log will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Send Notice Section -->
                <div class="content-section" id="sendNoticeSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-bullhorn"></i> Send New Notice</h2>
                        <p>Notices will be sent to Teachers & Students apps</p>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label for="noticeTitle">Notice Title *</label>
                            <input type="text" id="noticeTitle" class="form-control" placeholder="Enter notice title">
                        </div>
                        
                        <div class="form-group">
                            <label for="noticeContent">Notice Content *</label>
                            <textarea id="noticeContent" class="form-control textarea" placeholder="Enter notice content..."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="noticePriority">Priority Level</label>
                                <select id="noticePriority" class="form-control">
                                    <option value="low">Low Priority</option>
                                    <option value="medium">Medium Priority</option>
                                    <option value="high">High Priority</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="noticeCategory">Category</label>
                                <select id="noticeCategory" class="form-control">
                                    <option value="general">General Announcement</option>
                                    <option value="academic">Academic</option>
                                    <option value="exam">Exam Related</option>
                                    <option value="event">School Event</option>
                                    <option value="holiday">Holiday</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Send To *</label>
                            <div style="display: flex; gap: 30px; margin-top: 10px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="sendToTeachers" checked>
                                    <label for="sendToTeachers">All Teachers</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="sendToStudents" checked>
                                    <label for="sendToStudents">All Students</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                                <i class="fas fa-save"></i> Save as Draft
                            </button>
                            <button type="button" class="btn btn-primary pulse" id="sendNoticeBtn">
                                <i class="fas fa-paper-plane"></i> Send Notice
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Notices Section -->
                <div class="content-section" id="manageNoticesSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-clipboard-list"></i> Manage Notices</h2>
                        <button class="btn btn-primary" id="refreshNoticesBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Priority</th>
                                    <th>Date</th>
                                    <th>Sent To</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="noticesTableBody">
                                <!-- Notices will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Manage Teachers Section -->
                <div class="content-section" id="manageTeachersSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-chalkboard-teacher"></i> Manage Teachers</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary active" id="showAllTeachersBtn">
                                <i class="fas fa-users"></i> All Teachers
                            </button>
                            <button class="btn btn-warning" id="showPendingTeachersBtn">
                                <i class="fas fa-clock"></i> Pending Approval
                                <span class="nav-count" id="pendingTeachersCount">0</span>
                            </button>
                            <button class="btn btn-success" id="addTeacherBtn">
                                <i class="fas fa-plus"></i> Add Teacher
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Profile</th>
                                    <th>Name</th>
                                    <th>Subject</th>
                                    <th>Grade</th>
                                    <th>Phone Number</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="teachersTableBody">
                                <!-- Teachers will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- NEW: Manage Students Section -->
                <div class="content-section" id="manageStudentsSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-user-graduate"></i> Manage Students</h2>
                        <button class="btn btn-primary" id="refreshStudentsBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Profile</th>
                                    <th>Name</th>
                                    <th>Roll No.</th>
                                    <th>Grade & Section</th>
                                    <th>Parent Name</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <!-- Students will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Manage Admins Section -->
                <div class="content-section" id="manageAdminsSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-user-shield"></i> Manage Admins</h2>
                        <button class="btn btn-success" id="addAdminBtn">
                            <i class="fas fa-plus"></i> Add Admin
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Profile</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <!-- Admins will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- NEW DEVELOPER SECTION -->
                <div class="content-section" id="developerSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-code"></i> Developer Data Management</h2>
                        <button class="btn btn-primary" id="refreshDeveloperDataBtn">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                    
                    <div class="developer-content">
                        <div class="developer-form">
                            <h3 style="margin-bottom: 20px; color: var(--primary);">
                                <i class="fas fa-plus-circle"></i> Add New Data with Links
                            </h3>
                            
                            <div class="form-group">
                                <label for="dataTitle">Title *</label>
                                <input type="text" id="dataTitle" class="form-control" placeholder="Enter title for the data">
                            </div>
                            
                            <div class="form-group">
                                <label for="dataDescription">Description *</label>
                                <textarea id="dataDescription" class="form-control textarea" placeholder="Enter description or content..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="dataLink">Link URL *</label>
                                <input type="url" id="dataLink" class="form-control" placeholder="https://example.com">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dataCategory">Category</label>
                                    <select id="dataCategory" class="form-control">
                                        <option value="general">General</option>
                                        <option value="important">Important</option>
                                        <option value="resource">Resource</option>
                                        <option value="tutorial">Tutorial</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="dataPriority">Priority</label>
                                    <select id="dataPriority" class="form-control">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-success" id="saveDeveloperDataBtn">
                                    <i class="fas fa-save"></i> Save Data to Firebase
                                </button>
                            </div>
                        </div>
                        
                        <div class="section-header">
                            <h2><i class="fas fa-list"></i> Stored Developer Data</h2>
                            <div id="developerDataCount" class="nav-count">0</div>
                        </div>
                        
                        <div id="developerDataList">
                            <!-- Developer data items will be loaded here -->
                            <div style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-database" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No data found</h3>
                                <p>Add your first data item using the form above</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div class="content-section" id="settingsSection" style="display: none;">
                    <div class="section-header">
                        <h2><i class="fas fa-cog"></i> Settings</h2>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <h3 style="margin-bottom: 20px; color: var(--primary);">
                                <i class="fas fa-user-circle"></i> Account Settings
                            </h3>
                        </div>
                        
                        <div class="form-group" style="text-align: center;">
                            <div class="profile-large-container" id="settingsProfileImage">
                                <i class="fas fa-user"></i>
                            </div>
                            <button type="button" class="btn btn-secondary" id="changeProfileBtn" style="margin-top: 10px;">
                                <i class="fas fa-camera"></i> Change Profile Picture
                            </button>
                            <input type="file" id="profileImageUpload" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="settingsName" class="form-control" value="VIJAY KUMAR">
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="settingsEmail" class="form-control" value="vijaygond2024@gmail.com" disabled>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" id="updateProfileBtn">
                                <i class="fas fa-save"></i> Update Profile
                            </button>
                        </div>
                        
                        <div class="form-group" style="margin-top: 40px;">
                            <h3 style="margin-bottom: 20px; color: var(--primary);">
                                <i class="fas fa-key"></i> Change Password
                            </h3>
                        </div>
                        
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                        </div>
                        
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="settingsNewPassword" class="form-control" placeholder="Enter new password">
                        </div>
                        
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="settingsConfirmPassword" class="form-control" placeholder="Confirm new password">
                        </div>
                        
                        <!-- Password Requirements Display -->
                        <div class="password-requirements" id="passwordRequirements" style="display: none;">
                            <h4>Password Requirements:</h4>
                            <ul>
                                <li id="reqLength">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    At least 6 characters
                                </li>
                                <li id="reqLowercase">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains lowercase letter
                                </li>
                                <li id="reqUppercase">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains uppercase letter
                                </li>
                                <li id="reqNumber">
                                    <i class="fas fa-circle requirement-not-met"></i>
                                    Contains number
                                </li>
                            </ul>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" id="changePasswordBtn">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Add Teacher Modal -->
    <div class="modal" id="addTeacherModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Teacher</h3>
                <button class="close-modal" id="closeTeacherModal">&times;</button>
            </div>
            
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" id="teacherName" class="form-control" placeholder="Enter teacher's full name">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Subject *</label>
                    <input type="text" id="teacherSubject" class="form-control" placeholder="e.g., Mathematics">
                </div>
                
                <div class="form-group">
                    <label>Grade/Class</label>
                    <input type="text" id="teacherGrade" class="form-control" placeholder="e.g., Grade 10">
                </div>
            </div>
            
            <div class="form-group">
                <label>Phone Number *</label>
                <input type="tel" id="teacherPhone" class="form-control" placeholder="+91 9876543210">
            </div>
            
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="teacherEmail" class="form-control" placeholder="teacher@school.com">
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelTeacherBtn">Cancel</button>
                <button type="button" class="btn btn-success" id="saveTeacherBtn">
                    <i class="fas fa-save"></i> Save Teacher
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Admin Modal -->
    <div class="modal" id="addAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Admin</h3>
                <button class="close-modal" id="closeAdminModal">&times;</button>
            </div>
            
            <div class="form-group" style="text-align: center;">
                <div class="profile-large-container" id="adminModalProfileImage">
                    <i class="fas fa-user"></i>
                </div>
                <button type="button" class="btn btn-secondary" id="changeAdminProfileBtn" style="margin-top: 10px;">
                    <i class="fas fa-camera"></i> Change Profile
                </button>
                <input type="file" id="adminProfileImageUpload" accept="image/*" style="display: none;">
            </div>
            
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" id="adminNameInput" class="form-control" placeholder="Enter admin's full name">
            </div>
            
            <div class="form-group">
                <label>Email Address *</label>
                <input type="email" id="adminEmailInput" class="form-control" placeholder="admin@school.com">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Role *</label>
                    <select id="adminRoleSelect" class="form-control">
                        <option value="admin">Admin</option>
                        <option value="super_admin">Super Admin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Status *</label>
                    <select id="adminStatusSelect" class="form-control">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Initial Password *</label>
                <input type="password" id="adminPasswordInput" class="form-control" placeholder="Enter initial password">
                <small style="color: var(--gray);">Admin can change this after login</small>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelAdminBtn">Cancel</button>
                <button type="button" class="btn btn-success" id="saveAdminBtn">
                    <i class="fas fa-save"></i> Create Admin
                </button>
            </div>
        </div>
    </div>
    
    <!-- OTP Verification Modal -->
    <div class="modal" id="otpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shield-alt"></i> OTP Verification</h3>
                <button class="close-modal" id="closeOtpModal">&times;</button>
            </div>
            
            <div class="form-group">
                <p id="otpMessage">Please enter the 6-digit OTP sent to your email.</p>
                <div class="otp-container">
                    <input type="text" class="otp-input" maxlength="1" data-index="0">
                    <input type="text" class="otp-input" maxlength="1" data-index="1">
                    <input type="text" class="otp-input" maxlength="1" data-index="2">
                    <input type="text" class="otp-input" maxlength="1" data-index="3">
                    <input type="text" class="otp-input" maxlength="1" data-index="4">
                    <input type="text" class="otp-input" maxlength="1" data-index="5">
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="resendOtpBtn">
                    <i class="fas fa-redo"></i> Resend OTP
                </button>
                <button type="button" class="btn btn-primary" id="verifyOtpModalBtn">
                    <i class="fas fa-check"></i> Verify OTP
                </button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> Confirm Delete</h3>
                <button class="close-modal" id="closeDeleteModal">&times;</button>
            </div>
            
            <div class="form-group">
                <p id="deleteMessage">Are you sure you want to delete this item? This action cannot be undone.</p>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>
    
    <!-- Teacher Details Modal -->
    <div class="modal" id="teacherDetailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-chalkboard-teacher"></i> Teacher Details</h3>
                <button class="close-modal" id="closeTeacherDetailsModal">&times;</button>
            </div>
            
            <div id="teacherDetailsContent">
                <!-- Teacher details will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Student Details Modal -->
    <div class="modal" id="studentDetailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-user-graduate"></i> Student Details</h3>
                <button class="close-modal" id="closeStudentDetailsModal">&times;</button>
            </div>
            
            <div id="studentDetailsContent">
                <!-- Student details will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Success Message -->
    <div id="successMessage" style="display: none;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-check-circle" style="font-size: 24px;"></i>
            <div>
                <h4 style="margin-bottom: 5px;">Success!</h4>
                <p id="successText">Operation completed successfully.</p>
            </div>
        </div>
    </div>
    
    <!-- Error Message -->
    <div id="errorMessage" style="display: none;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-exclamation-circle" style="font-size: 24px;"></i>
            <div>
                <h4 style="margin-bottom: 5px;">Error!</h4>
                <p id="errorText">An error occurred.</p>
            </div>
        </div>
    </div>
    
    <!-- Firebase Configuration and App Logic -->
    <script>
        // ============================
        // CONFIGURATION SECTION
        // ============================
        
        // 1. FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyDcKkAf2SRmfiJizVA71fILOqRZTtUGAdY",
            authDomain: "schooladmin-51cdd.firebaseapp.com",
            databaseURL: "https://schooladmin-51cdd-default-rtdb.firebaseio.com",
            projectId: "schooladmin-51cdd",
            storageBucket: "schooladmin-51cdd.appspot.com",
            messagingSenderId: "185301938780",
            appId: "1:185301938780:web:bdeaabff3c7d2bff2bac99",
            measurementId: "G-V8C5DE930K"
        };

        // 2. EMAILJS CONFIGURATION
        const EMAILJS_CONFIG = {
            SERVICE_ID: 'service_u035226',
            TEMPLATE_ID: 'template_xyk8468',
            PUBLIC_KEY: 'D-8liyb21zvqmvhPc',
            OTP_TEMPLATE_ID: 'template_xyk8468'
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }
        
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Initialize EmailJS
        (function() {
            emailjs.init(EMAILJS_CONFIG.PUBLIC_KEY);
            console.log("EmailJS initialized");
        })();

        // ============================
        // APPLICATION STATE
        // ============================
        let currentUser = null;
        let currentAdmin = null;
        let notices = [];
        let teachers = [];
        let students = []; // NEW: For storing students data
        let admins = [];
        let developerData = []; // For storing developer data
        let activityLog = [];
        let itemToDelete = null;
        let deleteType = null;
        let teacherFilter = 'all';
        let pendingPasswordReset = null;
        let currentOtp = null;
        let otpType = null;
        let failedLoginAttempts = 0;
        let lastFailedLoginTime = null;

        // ============================
        // DOM ELEMENTS
        // ============================
        const authContainer = document.getElementById('authContainer');
        const adminPanel = document.getElementById('adminPanel');
        const adminName = document.getElementById('adminName');
        const adminEmail = document.getElementById('adminEmail');
        const adminAvatar = document.getElementById('adminAvatar');
        
        // Auth Elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authTabContents = document.querySelectorAll('.auth-tab-content');
        const loginBtn = document.getElementById('loginBtn');
        const simpleForgotBtn = document.getElementById('simpleForgotBtn');
        const sendResetOtpBtn = document.getElementById('sendResetOtpBtn');
        const resetPasswordBtn = document.getElementById('resetPasswordBtn');
        const otpInputs = document.querySelectorAll('.otp-input');
        const newPasswordFields = document.getElementById('newPasswordFields');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
        
        // Verify OTP Button in Forgot Password Form
        const verifyOtpBtnForgot = document.getElementById('verifyOtpBtn');
        
        // Navigation
        const navLinks = document.querySelectorAll('.nav-links a');
        const contentSections = document.querySelectorAll('.content-section');
        
        // Dashboard Elements
        const totalNoticesCount = document.getElementById('totalNoticesCount');
        const totalTeachersCount = document.getElementById('totalTeachersCount');
        const totalStudentsCount = document.getElementById('totalStudentsCount');
        const totalDeveloperDataCount = document.getElementById('totalDeveloperDataCount');
        const noticeCount = document.getElementById('noticeCount');
        const teacherCount = document.getElementById('teacherCount');
        const studentCount = document.getElementById('studentCount'); // NEW
        const adminCount = document.getElementById('adminCount');
        const activityLogTable = document.getElementById('activityLog');
        const currentDateElement = document.getElementById('currentDate');
        const refreshActivityBtn = document.getElementById('refreshActivityBtn');
        const clearActivityBtn = document.getElementById('clearActivityBtn');
        
        // Trend Elements
        const noticesTrend = document.getElementById('noticesTrend');
        const teachersTrend = document.getElementById('teachersTrend');
        const studentsTrend = document.getElementById('studentsTrend');
        
        // Notice Elements
        const sendNoticeBtn = document.getElementById('sendNoticeBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const refreshNoticesBtn = document.getElementById('refreshNoticesBtn');
        const noticesTableBody = document.getElementById('noticesTableBody');
        
        // Teacher Elements
        const addTeacherBtn = document.getElementById('addTeacherBtn');
        const teachersTableBody = document.getElementById('teachersTableBody');
        const saveTeacherBtn = document.getElementById('saveTeacherBtn');
        const cancelTeacherBtn = document.getElementById('cancelTeacherBtn');
        const showAllTeachersBtn = document.getElementById('showAllTeachersBtn');
        const showPendingTeachersBtn = document.getElementById('showPendingTeachersBtn');
        const pendingTeachersCount = document.getElementById('pendingTeachersCount');
        
        // NEW: Student Elements
        const refreshStudentsBtn = document.getElementById('refreshStudentsBtn');
        const studentsTableBody = document.getElementById('studentsTableBody');
        
        // Admin Elements
        const addAdminBtn = document.getElementById('addAdminBtn');
        const adminsTableBody = document.getElementById('adminsTableBody');
        const saveAdminBtn = document.getElementById('saveAdminBtn');
        const cancelAdminBtn = document.getElementById('cancelAdminBtn');
        
        // Developer Elements
        const refreshDeveloperDataBtn = document.getElementById('refreshDeveloperDataBtn');
        const saveDeveloperDataBtn = document.getElementById('saveDeveloperDataBtn');
        const developerDataList = document.getElementById('developerDataList');
        const developerDataCountElement = document.getElementById('developerDataCount');
        
        // Settings Elements
        const settingsProfileImage = document.getElementById('settingsProfileImage');
        const changeProfileBtn = document.getElementById('changeProfileBtn');
        const profileImageUpload = document.getElementById('profileImageUpload');
        const updateProfileBtn = document.getElementById('updateProfileBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Password Requirements Elements
        const passwordRequirements = document.getElementById('passwordRequirements');
        const settingsNewPasswordInput = document.getElementById('settingsNewPassword');
        
        // Success/Error Messages
        const successMessage = document.getElementById('successMessage');
        const successText = document.getElementById('successText');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // ============================
        // INITIALIZE APPLICATION
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded");
            
            // Set current date
            const now = new Date();
            currentDateElement.textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Set up event listeners
            setupEventListeners();
            
            // Check if user is already logged in
            checkAuthState();
            
            // Load sample data for demo
            loadSampleData();
        });

        // ============================
        // EVENT LISTENERS SETUP
        // ============================
        function setupEventListeners() {
            console.log("Setting up event listeners");
            
            // Auth Tabs
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    authTabContents.forEach(content => {
                        content.style.display = 'none';
                        if (content.id === tabId + 'Tab') {
                            content.style.display = 'block';
                        }
                    });
                    
                    // Clear OTP fields when switching tabs
                    clearOtpInputs();
                    document.getElementById('resetOtpSection').style.display = 'none';
                    newPasswordFields.style.display = 'none';
                    resetPasswordBtn.style.display = 'none';
                    verifyOtpBtnForgot.style.display = 'none';
                    document.getElementById('sendResetOtpBtn').style.display = 'block';
                    
                });
            });
            
            // Simple Forgot Password Button
            simpleForgotBtn.addEventListener('click', function() {
                // Switch to forgot password tab
                authTabs.forEach(t => t.classList.remove('active'));
                authTabs[1].classList.add('active');
                authTabContents.forEach(content => {
                    content.style.display = 'none';
                    if (content.id === 'forgotTab') {
                        content.style.display = 'block';
                    }
                });
            });
            
            // OTP Input Handling
            otpInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const value = this.value;
                    const index = parseInt(this.dataset.index);
                    
                    // Only allow numbers
                    if (!/^\d*$/.test(value)) {
                        this.value = value.replace(/\D/g, '');
                        return;
                    }
                    
                    // Move to next input if current is filled
                    if (value.length === 1 && index < 5) {
                        otpInputs[index + 1].focus();
                    }
                    
                    // Move to previous input on backspace
                    if (value.length === 0 && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
                
                // Handle paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pastedData = e.clipboardData.getData('text').trim();
                    
                    if (pastedData.length === 6 && /^\d+$/.test(pastedData)) {
                        for (let i = 0; i < 6; i++) {
                            if (otpInputs[i]) {
                                otpInputs[i].value = pastedData[i];
                            }
                        }
                        otpInputs[5].focus();
                    }
                });
            });
            
            // Auth Buttons
            loginBtn.addEventListener('click', handleLogin);
            sendResetOtpBtn.addEventListener('click', sendPasswordResetOtp);
            resetPasswordBtn.addEventListener('click', handlePasswordReset);
            
            // Verify OTP Button in Forgot Password Form
            verifyOtpBtnForgot.addEventListener('click', verifyOtpInForgotForm);
            
            // OTP Modal
            document.getElementById('verifyOtpModalBtn').addEventListener('click', verifyOtp);
            resendOtpBtn.addEventListener('click', resendOtp);
            
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Update active nav
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = link.dataset.section + 'Section';
                    contentSections.forEach(section => {
                        section.style.display = 'none';
                        if (section.id === sectionId) {
                            section.style.display = 'block';
                        }
                    });
                    
                    // Load section data if needed
                    if (sectionId === 'manageNoticesSection') {
                        loadNoticesTable();
                    } else if (sectionId === 'manageTeachersSection') {
                        loadTeachersTable();
                    } else if (sectionId === 'manageStudentsSection') {
                        loadStudentsTable(); // NEW: Load students
                    } else if (sectionId === 'manageAdminsSection') {
                        loadAdminsTable();
                    } else if (sectionId === 'developerSection') {
                        loadDeveloperData();
                    } else if (sectionId === 'dashboardSection') {
                        loadActivityLogFromDB();
                    }
                });
            });

            // Activity Log Buttons
            refreshActivityBtn.addEventListener('click', loadActivityLogFromDB);
            clearActivityBtn.addEventListener('click', clearAllActivities);

            // Notice Management
            sendNoticeBtn.addEventListener('click', sendNotice);
            saveDraftBtn.addEventListener('click', saveNoticeAsDraft);
            refreshNoticesBtn.addEventListener('click', loadNoticesTable);

            // Teacher Management
            addTeacherBtn.addEventListener('click', () => {
                document.getElementById('addTeacherModal').style.display = 'flex';
            });
            
            saveTeacherBtn.addEventListener('click', saveTeacher);
            cancelTeacherBtn.addEventListener('click', () => {
                document.getElementById('addTeacherModal').style.display = 'none';
                clearTeacherForm();
            });
            
            closeTeacherModal.addEventListener('click', () => {
                document.getElementById('addTeacherModal').style.display = 'none';
                clearTeacherForm();
            });

            // NEW: Student Management
            refreshStudentsBtn.addEventListener('click', loadStudentsTable);
            closeStudentDetailsModal.addEventListener('click', () => {
                studentDetailsModal.style.display = 'none';
            });

            // Admin Management
            addAdminBtn.addEventListener('click', () => {
                document.getElementById('addAdminModal').style.display = 'flex';
            });
            
            saveAdminBtn.addEventListener('click', saveAdmin);
            cancelAdminBtn.addEventListener('click', () => {
                document.getElementById('addAdminModal').style.display = 'none';
                clearAdminForm();
            });
            
            closeAdminModal.addEventListener('click', () => {
                document.getElementById('addAdminModal').style.display = 'none';
                clearAdminForm();
            });

            // Teacher Filter Buttons
            showAllTeachersBtn.addEventListener('click', () => {
                teacherFilter = 'all';
                showAllTeachersBtn.classList.add('active');
                showPendingTeachersBtn.classList.remove('active');
                loadTeachersTable();
            });
            
            showPendingTeachersBtn.addEventListener('click', () => {
                teacherFilter = 'pending';
                showPendingTeachersBtn.classList.add('active');
                showAllTeachersBtn.classList.remove('active');
                loadTeachersTable();
            });

            // Teacher Details Modal
            closeTeacherDetailsModal.addEventListener('click', () => {
                teacherDetailsModal.style.display = 'none';
            });

            // Modal Controls
            closeDeleteModal.addEventListener('click', () => {
                document.getElementById('deleteModal').style.display = 'none';
            });
            
            closeOtpModal.addEventListener('click', () => {
                document.getElementById('otpModal').style.display = 'none';
                clearOtpInputs();
            });
            
            cancelDeleteBtn.addEventListener('click', () => {
                document.getElementById('deleteModal').style.display = 'none';
                itemToDelete = null;
                deleteType = null;
            });
            
            confirmDeleteBtn.addEventListener('click', confirmDelete);

            // Developer Data Management
            refreshDeveloperDataBtn.addEventListener('click', loadDeveloperData);
            saveDeveloperDataBtn.addEventListener('click', saveDeveloperData);

            // Settings
            changeProfileBtn.addEventListener('click', () => {
                profileImageUpload.click();
            });
            
            profileImageUpload.addEventListener('change', handleProfileImageUpload);
            updateProfileBtn.addEventListener('click', updateProfile);
            changePasswordBtn.addEventListener('click', changePassword);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Password requirement checking for settings
            settingsNewPasswordInput.addEventListener('input', checkPasswordRequirements);
            settingsNewPasswordInput.addEventListener('focus', () => {
                passwordRequirements.style.display = 'block';
            });
            settingsNewPasswordInput.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!settingsNewPasswordInput.matches(':focus')) {
                        passwordRequirements.style.display = 'none';
                    }
                }, 200);
            });
            
            // Password requirement checking for forgot password
            newPasswordInput.addEventListener('input', checkForgotPasswordRequirements);
            
            // Real-time validation for new password fields in forgot password
            newPasswordInput.addEventListener('input', validateForgotPasswordFields);
            confirmNewPasswordInput.addEventListener('input', validateForgotPasswordFields);
        }

        // ============================
        // ENHANCED ACTIVITY LOG SYSTEM
        // ============================
        
        async function loadActivityLogFromDB() {
            try {
                refreshActivityBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                refreshActivityBtn.disabled = true;
                
                // Try to load from Firebase first
                const snapshot = await database.ref('activity_log').orderByChild('timestamp').limitToLast(50).once('value');
                
                activityLog = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const activity = childSnapshot.val();
                        activity.id = childSnapshot.key;
                        activityLog.unshift(activity); // Add to beginning to show newest first
                    });
                }
                
                // If no activities in Firebase, load from localStorage
                if (activityLog.length === 0) {
                    const localActivities = JSON.parse(localStorage.getItem('activity_log') || '[]');
                    activityLog = localActivities.slice(-50).reverse(); // Get last 50 activities
                }
                
                displayActivityLog();
                
            } catch (error) {
                console.error('Failed to load activity log from database:', error);
                // Load from localStorage
                const localActivities = JSON.parse(localStorage.getItem('activity_log') || '[]');
                activityLog = localActivities.slice(-50).reverse();
                displayActivityLog();
            } finally {
                refreshActivityBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                refreshActivityBtn.disabled = false;
            }
        }
        
        function displayActivityLog() {
            activityLogTable.innerHTML = '';
            
            if (activityLog.length === 0) {
                activityLogTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="no-activities">
                            <i class="fas fa-history"></i>
                            <h3>No activities yet</h3>
                            <p>Start using the admin panel to see activities here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            activityLog.forEach(activity => {
                const row = document.createElement('tr');
                
                // Format date and time
                let timeDisplay = '';
                if (activity.timestamp) {
                    const activityDate = new Date(activity.timestamp);
                    const now = new Date();
                    const diffMs = now - activityDate;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 1) {
                        timeDisplay = 'Just now';
                    } else if (diffMins < 60) {
                        timeDisplay = `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
                    } else if (diffHours < 24) {
                        timeDisplay = `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
                    } else if (diffDays === 1) {
                        timeDisplay = 'Yesterday, ' + activityDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    } else if (diffDays < 7) {
                        timeDisplay = activityDate.toLocaleDateString('en-US', { weekday: 'long' }) + ', ' + 
                                     activityDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    } else {
                        timeDisplay = activityDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ', ' + 
                                     activityDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    }
                } else {
                    timeDisplay = 'Recently';
                }
                
                // Status class
                let statusClass = 'activity-status-completed';
                let statusText = 'Completed';
                
                if (activity.status === 'failed') {
                    statusClass = 'activity-status-failed';
                    statusText = 'Failed';
                } else if (activity.status === 'pending') {
                    statusClass = 'activity-status-pending';
                    statusText = 'Pending';
                }
                
                row.innerHTML = `
                    <td>${timeDisplay}</td>
                    <td>${activity.action || activity.activity}</td>
                    <td>${activity.details || activity.description || ''}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                `;
                
                activityLogTable.appendChild(row);
            });
        }
        
        async function addActivityLog(action, details, status = 'completed') {
            if (!currentUser || !currentAdmin) return;
            
            const activity = {
                action: action,
                details: details,
                status: status,
                timestamp: new Date().toISOString(),
                user: currentUser.uid,
                userName: currentAdmin.name || currentUser.displayName || 'Admin',
                userEmail: currentAdmin.email || currentUser.email || 'admin@school.com'
            };
            
            // Add to local array
            activityLog.unshift(activity);
            
            // Update display if on dashboard
            if (document.getElementById('dashboardSection').style.display === 'block') {
                displayActivityLog();
            }
            
            // Save to Firebase
            try {
                const activityId = database.ref().child('activity_log').push().key;
                await database.ref('activity_log/' + activityId).set(activity);
            } catch (error) {
                console.warn('Could not save activity to Firebase:', error);
            }
            
            // Save to localStorage as backup
            try {
                const localActivities = JSON.parse(localStorage.getItem('activity_log') || '[]');
                localActivities.push(activity);
                // Keep only last 100 activities in localStorage
                if (localActivities.length > 100) {
                    localActivities.splice(0, localActivities.length - 100);
                }
                localStorage.setItem('activity_log', JSON.stringify(localActivities));
            } catch (error) {
                console.warn('Could not save activity to localStorage:', error);
            }
        }
        
        async function clearAllActivities() {
            const confirmation = confirm('Are you sure you want to clear all activity logs? This action cannot be undone.');
            if (!confirmation) return;
            
            try {
                // Clear from Firebase
                await database.ref('activity_log').remove();
                
                // Clear from localStorage
                localStorage.removeItem('activity_log');
                
                // Clear local array
                activityLog = [];
                
                // Update display
                displayActivityLog();
                
                showSuccess('All activity logs cleared successfully!');
                addActivityLog('Cleared Activity Log', 'All activity logs removed', 'completed');
                
            } catch (error) {
                showError('Failed to clear activity logs: ' + error.message);
            }
        }

        // ============================
        // EMAILJS OTP FUNCTIONS
        // ============================
        async function sendOtpEmail(email, otp, type) {
            try {
                const templateParams = {
                    to_email: email,
                    otp_code: otp,
                    type: type === 'password_reset' ? 'Password Reset' : 'OTP Verification',
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString()
                };

                const response = await emailjs.send(
                    EMAILJS_CONFIG.SERVICE_ID,
                    EMAILJS_CONFIG.TEMPLATE_ID,
                    templateParams
                );
                
                console.log("OTP email sent successfully:", response);
                return true;
            } catch (error) {
                console.error('EmailJS Error:', error);
                return true; // For demo purposes
            }
        }

        function generateOtp() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // ============================
        // SIMPLIFIED PASSWORD RESET FLOW
        // ============================
        async function sendPasswordResetOtp() {
            const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
            
            if (!email) {
                showError('Please enter your email address');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('Please enter a valid email address');
                return;
            }
            
            const btn = sendResetOtpBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending OTP...';
            btn.disabled = true;
            
            try {
                try {
                    const methods = await auth.fetchSignInMethodsForEmail(email);
                    if (methods.length === 0) {
                        showError('Email not registered. Please check your email address.');
                        return;
                    }
                } catch (error) {
                    console.log("Could not verify email, continuing anyway:", error);
                }
                
                currentOtp = generateOtp();
                otpType = 'password_reset';
                pendingPasswordReset = { email };
                
                const emailSent = await sendOtpEmail(email, currentOtp, 'password_reset');
                
                if (emailSent) {
                    showSuccess('Password reset OTP sent to your email! Please check your inbox.');
                    
                    document.getElementById('resetOtpSection').style.display = 'block';
                    verifyOtpBtnForgot.style.display = 'block';
                    sendResetOtpBtn.style.display = 'none';
                    
                    document.querySelectorAll('.otp-input')[0].focus();
                } else {
                    showError('Failed to send OTP. Please try again.');
                }
                
            } catch (authError) {
                console.error('Error:', authError);
                showError('Error: ' + authError.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Verify OTP in Forgot Password Form
        async function verifyOtpInForgotForm() {
            const enteredOtp = getOtpFromInputs();
            
            if (enteredOtp.length !== 6) {
                showError('Please enter the complete 6-digit OTP');
                return;
            }
            
            if (enteredOtp !== currentOtp) {
                showError('Invalid OTP. Please try again.');
                return;
            }
            
            const btn = verifyOtpBtnForgot;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            btn.disabled = true;
            
            try {
                showSuccess('OTP verified successfully! Now you can set your new password.');
                
                document.getElementById('resetOtpSection').style.display = 'none';
                verifyOtpBtnForgot.style.display = 'none';
                newPasswordFields.style.display = 'block';
                resetPasswordBtn.style.display = 'none';
                
            } catch (error) {
                showError('OTP verification failed: ' + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Validate forgot password fields in real-time
        function validateForgotPasswordFields() {
            const newPassword = newPasswordInput.value;
            const confirmNewPassword = confirmNewPasswordInput.value;
            
            if (newPassword && confirmNewPassword && newPassword === confirmNewPassword) {
                let requirements = [];
                if (newPassword.length < 6) requirements.push('at least 6 characters');
                if (!/[a-z]/.test(newPassword)) requirements.push('one lowercase letter');
                if (!/[A-Z]/.test(newPassword)) requirements.push('one uppercase letter');
                if (!/[0-9]/.test(newPassword)) requirements.push('one number');
                
                if (requirements.length === 0) {
                    resetPasswordBtn.style.display = 'block';
                } else {
                    resetPasswordBtn.style.display = 'none';
                }
            } else {
                resetPasswordBtn.style.display = 'none';
            }
        }

        function getOtpFromInputs() {
            let otp = '';
            otpInputs.forEach(input => {
                otp += input.value;
            });
            return otp;
        }

        function clearOtpInputs() {
            otpInputs.forEach(input => {
                input.value = '';
            });
        }

        function checkForgotPasswordRequirements() {
            const password = newPasswordInput.value;
            
            if (!password) {
                return;
            }
            
            // Check length
            const lengthReq = document.getElementById('forgotReqLength');
            if (password.length >= 6) {
                lengthReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                lengthReq.style.color = 'var(--success)';
            } else {
                lengthReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                lengthReq.style.color = 'var(--danger)';
            }
            
            // Check lowercase
            const lowercaseReq = document.getElementById('forgotReqLowercase');
            if (/[a-z]/.test(password)) {
                lowercaseReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                lowercaseReq.style.color = 'var(--success)';
            } else {
                lowercaseReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                lowercaseReq.style.color = 'var(--danger)';
            }
            
            // Check uppercase
            const uppercaseReq = document.getElementById('forgotReqUppercase');
            if (/[A-Z]/.test(password)) {
                uppercaseReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                uppercaseReq.style.color = 'var(--success)';
            } else {
                uppercaseReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                uppercaseReq.style.color = 'var(--danger)';
            }
            
            // Check number
            const numberReq = document.getElementById('forgotReqNumber');
            if (/[0-9]/.test(password)) {
                numberReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                numberReq.style.color = 'var(--success)';
            } else {
                numberReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                numberReq.style.color = 'var(--danger)';
            }
        }

        async function handlePasswordReset() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            if (!newPassword || !confirmNewPassword) {
                showError('Please enter new password and confirm it');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showError('Passwords do not match');
                return;
            }
            
            let requirements = [];
            if (newPassword.length < 6) requirements.push('at least 6 characters');
            if (!/[a-z]/.test(newPassword)) requirements.push('one lowercase letter');
            if (!/[A-Z]/.test(newPassword)) requirements.push('one uppercase letter');
            if (!/[0-9]/.test(newPassword)) requirements.push('one number');
            
            if (requirements.length > 0) {
                showError('Password must contain: ' + requirements.join(', '));
                return;
            }
            
            const btn = resetPasswordBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing Password...';
            btn.disabled = true;
            
            try {
                const email = pendingPasswordReset.email;
                
                try {
                    await auth.sendPasswordResetEmail(email);
                    
                    showSuccess('Password reset email sent! Check your inbox for reset instructions.');
                    
                    document.getElementById('forgotEmail').value = '';
                    newPasswordInput.value = '';
                    confirmNewPasswordInput.value = '';
                    document.getElementById('resetOtpSection').style.display = 'none';
                    newPasswordFields.style.display = 'none';
                    resetPasswordBtn.style.display = 'none';
                    verifyOtpBtnForgot.style.display = 'none';
                    document.getElementById('sendResetOtpBtn').style.display = 'block';
                    clearOtpInputs();
                    
                    showSuccess('Password reset email sent! Please check your inbox and follow the link to set a new password. After resetting, you can login with your new password.');
                    
                    pendingPasswordReset = null;
                    currentOtp = null;
                    otpType = null;
                    
                    setTimeout(() => {
                        authTabs.forEach(t => t.classList.remove('active'));
                        authTabs[0].classList.add('active');
                        authTabContents.forEach(content => content.style.display = 'none');
                        document.getElementById('loginTab').style.display = 'block';
                        
                        document.getElementById('loginEmail').value = email;
                        document.getElementById('loginPassword').value = '';
                        
                        showSuccess('Please check your email for password reset link. After resetting, use your new password to login.');
                    }, 3000);
                    
                } catch (error) {
                    console.error('Password reset error:', error);
                    
                    if (error.code === 'auth/user-not-found') {
                        showError('Email not registered. Please check your email address.');
                    } else if (error.code === 'auth/too-many-requests') {
                        showError('Too many attempts. Please try again later or reset password from Firebase console.');
                    } else {
                        showError('Password reset failed: ' + error.message);
                    }
                }
                
            } catch (error) {
                console.error('Unexpected error:', error);
                showError('An unexpected error occurred: ' + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ============================
        // OTP VERIFICATION FUNCTIONS (Modal)
        // ============================
        async function verifyOtp() {
            const enteredOtp = getOtpFromInputs();
            
            if (enteredOtp.length !== 6) {
                showError('Please enter the complete 6-digit OTP');
                return;
            }
            
            if (enteredOtp !== currentOtp) {
                showError('Invalid OTP. Please try again.');
                return;
            }
            
            if (otpType === 'password_reset' && pendingPasswordReset) {
                document.getElementById('otpModal').style.display = 'none';
                clearOtpInputs();
                
                newPasswordFields.style.display = 'block';
                resetPasswordBtn.style.display = 'none';
                
                showSuccess('OTP verified! Now enter your new password.');
            }
        }

        async function resendOtp() {
            if (!pendingPasswordReset) {
                showError('No pending operation to resend OTP');
                return;
            }
            
            const btn = resendOtpBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resending...';
            btn.disabled = true;
            
            try {
                currentOtp = generateOtp();
                
                let email, type;
                if (pendingPasswordReset) {
                    email = pendingPasswordReset.email;
                    type = 'password_reset';
                }
                
                const emailSent = await sendOtpEmail(email, currentOtp, type);
                
                if (emailSent) {
                    showSuccess('New OTP sent to your email!');
                } else {
                    showError('Failed to resend OTP. Please try again.');
                }
                
            } catch (error) {
                showError('Error resending OTP: ' + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ============================
        // PASSWORD REQUIREMENT CHECKING
        // ============================
        function checkPasswordRequirements() {
            const password = settingsNewPasswordInput.value;
            
            if (!password) {
                passwordRequirements.style.display = 'none';
                return;
            }
            
            passwordRequirements.style.display = 'block';
            
            // Check length
            const lengthReq = document.getElementById('reqLength');
            if (password.length >= 6) {
                lengthReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                lengthReq.style.color = 'var(--success)';
            } else {
                lengthReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                lengthReq.style.color = 'var(--danger)';
            }
            
            // Check lowercase
            const lowercaseReq = document.getElementById('reqLowercase');
            if (/[a-z]/.test(password)) {
                lowercaseReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                lowercaseReq.style.color = 'var(--success)';
            } else {
                lowercaseReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                lowercaseReq.style.color = 'var(--danger)';
            }
            
            // Check uppercase
            const uppercaseReq = document.getElementById('reqUppercase');
            if (/[A-Z]/.test(password)) {
                uppercaseReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                uppercaseReq.style.color = 'var(--success)';
            } else {
                uppercaseReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                uppercaseReq.style.color = 'var(--danger)';
            }
            
            // Check number
            const numberReq = document.getElementById('reqNumber');
            if (/[0-9]/.test(password)) {
                numberReq.querySelector('i').className = 'fas fa-check-circle requirement-met';
                numberReq.style.color = 'var(--success)';
            } else {
                numberReq.querySelector('i').className = 'fas fa-circle requirement-not-met';
                numberReq.style.color = 'var(--danger)';
            }
        }

        // ============================
        // FIREBASE AUTHENTICATION FUNCTIONS
        // ============================
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                console.log("Auth state changed:", user);
                if (user) {
                    console.log("User is logged in:", user.email);
                    currentUser = user;
                    failedLoginAttempts = 0;
                    lastFailedLoginTime = null;
                    
                    loadAdminData(user.uid).then(() => {
                        showAdminPanel();
                    }).catch(error => {
                        console.error("Error loading admin data:", error);
                        showAdminPanel();
                    });
                } else {
                    console.log("No user logged in");
                    authContainer.style.display = 'flex';
                    adminPanel.style.display = 'none';
                }
            });
        }

        // Load admin data from Realtime Database
        async function loadAdminData(uid) {
            try {
                const snapshot = await database.ref('admins/' + uid).once('value');
                if (snapshot.exists()) {
                    currentAdmin = snapshot.val();
                    currentAdmin.id = uid;
                    
                    adminName.textContent = currentAdmin.name || currentUser.displayName || 'Admin User';
                    adminEmail.textContent = currentAdmin.email || currentUser.email || 'admin@school.com';
                    
                    updateProfileImage(adminAvatar, currentAdmin.profileImage);
                    updateProfileImage(settingsProfileImage, currentAdmin.profileImage);
                    
                    document.getElementById('settingsName').value = currentAdmin.name || currentUser.displayName || 'Admin User';
                    document.getElementById('settingsEmail').value = currentAdmin.email || currentUser.email || 'admin@school.com';
                } else {
                    currentAdmin = {
                        id: uid,
                        name: currentUser.displayName || 'Admin User',
                        email: currentUser.email || 'admin@school.com',
                        role: 'admin',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    };
                    
                    await database.ref('admins/' + uid).set(currentAdmin);
                }
            } catch (error) {
                console.error("Error loading admin data:", error);
                currentAdmin = {
                    id: uid,
                    name: currentUser?.displayName || 'Admin User',
                    email: currentUser?.email || 'admin@school.com',
                    role: 'admin',
                    status: 'active'
                };
            }
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            console.log("Login attempt with:", email);
            
            if (!email || !password) {
                showError('Please enter email and password');
                return;
            }
            
            const now = new Date();
            if (failedLoginAttempts >= 5) {
                if (lastFailedLoginTime) {
                    const timeDiff = (now - lastFailedLoginTime) / 1000;
                    if (timeDiff < 300) {
                        showError('Too many failed attempts. Please wait 5 minutes before trying again.');
                        return;
                    } else {
                        failedLoginAttempts = 0;
                        lastFailedLoginTime = null;
                    }
                }
            }
            
            const btn = loginBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            btn.disabled = true;
            
            try {
                console.log("Attempting Firebase login...");
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                console.log("Login successful:", currentUser.email);
                
                failedLoginAttempts = 0;
                lastFailedLoginTime = null;
                
                try {
                    await database.ref('admins/' + currentUser.uid).update({
                        lastLogin: new Date().toISOString()
                    });
                } catch (dbError) {
                    console.warn('Could not update last login in database:', dbError);
                }
                
                showSuccess('Login successful!');
                
                // Add login activity
                addActivityLog('Admin Login', `Logged in from ${navigator.userAgent.substring(0, 50)}...`, 'completed');
                
                await loadAdminData(currentUser.uid);
                showAdminPanel();
                
            } catch (error) {
                console.error('Login error:', error);
                
                failedLoginAttempts++;
                lastFailedLoginTime = new Date();
                
                let errorMessage = 'Login failed: ';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Email not registered. Please check your email address.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Invalid password. Please try again.';
                    if (failedLoginAttempts >= 3) {
                        errorMessage += ' If you forgot your password, use the "Forgot Password" tab.';
                    }
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format. Please enter a valid email address.';
                } else if (error.code === 'auth/user-disabled') {
                    errorMessage = 'This account has been disabled. Please contact administrator.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Too many failed attempts. Access temporarily blocked. Please try again later or reset your password.';
                    errorMessage += ' You can reset your password using the "Forgot Password" tab.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Network error. Please check your internet connection.';
                } else {
                    errorMessage += error.message;
                }
                
                showError(errorMessage);
                
                // Add failed login activity
                addActivityLog('Failed Login', `Failed login attempt for ${email}`, 'failed');
                
                if (failedLoginAttempts >= 5) {
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<i class="fas fa-clock"></i> Try again in 5 minutes';
                    
                    setTimeout(() => {
                        loginBtn.disabled = false;
                        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login to Admin Panel';
                        failedLoginAttempts = 0;
                        lastFailedLoginTime = null;
                    }, 300000);
                }
            } finally {
                if (!loginBtn.disabled) {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            }
        }

        function handleLogout() {
            auth.signOut().then(() => {
                console.log("Logout successful");
                
                localStorage.removeItem('schoolAdminUser');
                
                // Add logout activity
                addActivityLog('Admin Logout', 'Logged out from admin panel', 'completed');
                
                currentUser = null;
                currentAdmin = null;
                
                authContainer.style.display = 'flex';
                adminPanel.style.display = 'none';
                
                clearLoginForm();
                
                showSuccess('Logged out successfully!');
            }).catch((error) => {
                console.error('Logout error:', error);
                showError('Logout failed: ' + error.message);
            });
        }

        // ============================
        // ADMIN PANEL FUNCTIONS
        // ============================
        function showAdminPanel() {
            console.log("Showing admin panel");
            
            adminName.textContent = currentAdmin?.name || currentUser?.displayName || 'Admin User';
            adminEmail.textContent = currentAdmin?.email || currentUser?.email || 'admin@school.com';
            
            updateProfileImage(adminAvatar, currentAdmin?.profileImage);
            updateProfileImage(settingsProfileImage, currentAdmin?.profileImage);
            
            authContainer.style.display = 'none';
            adminPanel.style.display = 'block';
            
            loadDashboardData();
            loadActivityLogFromDB();
        }

        // Function to update profile image
        function updateProfileImage(container, imageUrl) {
            if (!container) return;
            
            if (imageUrl && (imageUrl.startsWith('http') || imageUrl.startsWith('blob'))) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = "Profile";
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.onerror = function() {
                    container.innerHTML = '<i class="fas fa-user"></i>';
                };
                container.innerHTML = '';
                container.appendChild(img);
            } else {
                container.innerHTML = '<i class="fas fa-user"></i>';
            }
        }

        async function loadDashboardData() {
            try {
                // Load notices count
                try {
                    const noticesSnapshot = await database.ref('notices').once('value');
                    const noticesCount = noticesSnapshot.exists() ? Object.keys(noticesSnapshot.val()).length : 0;
                    totalNoticesCount.textContent = noticesCount;
                    noticeCount.textContent = noticesCount;
                    
                    // Calculate notices this week
                    let noticesThisWeek = 0;
                    if (noticesSnapshot.exists()) {
                        const oneWeekAgo = new Date();
                        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                        
                        noticesSnapshot.forEach((childSnapshot) => {
                            const notice = childSnapshot.val();
                            if (notice.timestamp) {
                                const noticeDate = new Date(notice.timestamp);
                                if (noticeDate >= oneWeekAgo) {
                                    noticesThisWeek++;
                                }
                            }
                        });
                    }
                    noticesTrend.textContent = `${noticesThisWeek} sent this week`;
                    
                } catch (error) {
                    console.warn('Could not load notices:', error);
                    totalNoticesCount.textContent = notices.length;
                    noticeCount.textContent = notices.length;
                    noticesTrend.textContent = `${notices.length} sent total`;
                }
                
                // Load teachers count
                try {
                    const teachersSnapshot = await database.ref('teachers').once('value');
                    let teachersCount = 0;
                    let pendingTeachers = 0;
                    let newTeachersThisMonth = 0;
                    
                    if (teachersSnapshot.exists()) {
                        const oneMonthAgo = new Date();
                        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                        
                        teachersSnapshot.forEach((childSnapshot) => {
                            const teacher = childSnapshot.val();
                            if (teacher.status === 'approved' || teacher.approved === true) {
                                teachersCount++;
                            }
                            if (teacher.status === 'pending' || teacher.approved === false) {
                                pendingTeachers++;
                            }
                            
                            // Check if teacher was added this month
                            if (teacher.addedDate) {
                                const addedDate = new Date(teacher.addedDate);
                                if (addedDate >= oneMonthAgo) {
                                    newTeachersThisMonth++;
                                }
                            }
                        });
                    }
                    
                    totalTeachersCount.textContent = teachersCount;
                    teacherCount.textContent = pendingTeachers;
                    pendingTeachersCount.textContent = pendingTeachers;
                    teachersTrend.textContent = `${newTeachersThisMonth} new this month`;
                    
                } catch (error) {
                    console.warn('Could not load teachers:', error);
                    const approvedTeachers = teachers.filter(t => 
                        t.status === 'approved' || t.approved === true
                    ).length;
                    totalTeachersCount.textContent = approvedTeachers;
                    
                    const pendingTeachers = teachers.filter(t => 
                        t.status === 'pending' || t.approved === false
                    ).length;
                    teacherCount.textContent = pendingTeachers;
                    pendingTeachersCount.textContent = pendingTeachers;
                    teachersTrend.textContent = `${teachers.length} total`;
                }
                
                // Load students count
                try {
                    const studentsSnapshot = await database.ref('students').once('value');
                    const studentsCount = studentsSnapshot.exists() ? Object.keys(studentsSnapshot.val()).length : 0;
                    totalStudentsCount.textContent = studentsCount;
                    studentCount.textContent = studentsCount;
                    
                    // Calculate active students today
                    let activeToday = 0;
                    if (studentsSnapshot.exists()) {
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        studentsSnapshot.forEach((childSnapshot) => {
                            const student = childSnapshot.val();
                            if (student.lastLogin) {
                                const lastLoginDate = new Date(student.lastLogin);
                                if (lastLoginDate >= today) {
                                    activeToday++;
                                }
                            }
                        });
                    }
                    studentsTrend.textContent = `${activeToday} active today`;
                    
                } catch (error) {
                    console.warn('Could not load students:', error);
                    totalStudentsCount.textContent = students.length;
                    studentCount.textContent = students.length;
                    studentsTrend.textContent = `${students.length} total`;
                }
                
                // Load developer data count
                try {
                    const developerDataSnapshot = await database.ref('developer_data').once('value');
                    const developerDataCount = developerDataSnapshot.exists() ? Object.keys(developerDataSnapshot.val()).length : 0;
                    totalDeveloperDataCount.textContent = developerDataCount;
                } catch (error) {
                    console.warn('Could not load developer data:', error);
                    totalDeveloperDataCount.textContent = developerData.length;
                }
                
                // Load admins count
                try {
                    const adminsSnapshot = await database.ref('admins').once('value');
                    const adminsCount = adminsSnapshot.exists() ? Object.keys(adminsSnapshot.val()).length : 1;
                    adminCount.textContent = adminsCount;
                } catch (error) {
                    console.warn('Could not load admins:', error);
                    adminCount.textContent = admins.length || 1;
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                totalNoticesCount.textContent = notices.length;
                noticeCount.textContent = notices.length;
                noticesTrend.textContent = `${notices.length} sent total`;
                
                const approvedTeachers = teachers.filter(t => 
                    t.status === 'approved' || t.approved === true
                ).length;
                totalTeachersCount.textContent = approvedTeachers;
                
                const pendingTeachers = teachers.filter(t => 
                    t.status === 'pending' || t.approved === false
                ).length;
                teacherCount.textContent = pendingTeachers;
                pendingTeachersCount.textContent = pendingTeachers;
                teachersTrend.textContent = `${teachers.length} total`;
                
                totalStudentsCount.textContent = students.length;
                studentCount.textContent = students.length;
                studentsTrend.textContent = `${students.length} total`;
                
                totalDeveloperDataCount.textContent = developerData.length;
                adminCount.textContent = admins.length || 1;
            }
        }

        // ============================
        // NOTICE MANAGEMENT FUNCTIONS
        // ============================
        async function sendNotice() {
            const title = document.getElementById('noticeTitle').value;
            const content = document.getElementById('noticeContent').value;
            const priority = document.getElementById('noticePriority').value;
            const category = document.getElementById('noticeCategory').value;
            const sendToTeachers = document.getElementById('sendToTeachers').checked;
            const sendToStudents = document.getElementById('sendToStudents').checked;
            
            if (!title || !content) {
                showError('Please enter notice title and content');
                return;
            }
            
            if (!sendToTeachers && !sendToStudents) {
                showError('Please select at least one recipient group');
                return;
            }
            
            const btn = sendNoticeBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            btn.disabled = true;
            
            try {
                // Try to save to database
                try {
                    const noticeId = database.ref().child('notices').push().key;
                    const noticeData = {
                        id: noticeId,
                        title: title,
                        content: content,
                        priority: priority,
                        category: category,
                        recipients: {
                            teachers: sendToTeachers,
                            students: sendToStudents
                        },
                        timestamp: new Date().toISOString(),
                        status: 'sent',
                        sentBy: currentUser.uid,
                        sentByName: currentAdmin?.name || currentUser.displayName || 'Admin'
                    };
                    
                    await database.ref('notices/' + noticeId).set(noticeData);
                    
                    notices.unshift(noticeData);
                    showSuccess('Notice sent successfully to Teachers & Students apps!');
                    
                    // Add activity log
                    addActivityLog('Sent Notice', `${title} (${priority} priority)`, 'completed');
                    
                } catch (dbError) {
                    console.warn('Could not save notice to database:', dbError);
                    // Save locally if database fails
                    const noticeData = {
                        id: 'notice_' + Date.now(),
                        title: title,
                        content: content,
                        priority: priority,
                        category: category,
                        recipients: {
                            teachers: sendToTeachers,
                            students: sendToStudents
                        },
                        timestamp: new Date().toISOString(),
                        status: 'sent',
                        sentBy: currentUser.uid,
                        sentByName: currentAdmin?.name || currentUser.displayName || 'Admin'
                    };
                    
                    notices.unshift(noticeData);
                    showSuccess('Notice saved locally! Database access failed.');
                    
                    // Add activity log
                    addActivityLog('Sent Notice', `${title} (saved locally)`, 'completed');
                }
                
                loadDashboardData();
                clearNoticeForm();
                
                if (document.getElementById('manageNoticesSection').style.display === 'block') {
                    loadNoticesTable();
                }
                
            } catch (error) {
                showError('Failed to send notice: ' + error.message);
                addActivityLog('Failed to Send Notice', title, 'failed');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function saveNoticeAsDraft() {
            const title = document.getElementById('noticeTitle').value;
            const content = document.getElementById('noticeContent').value;
            
            if (!title || !content) {
                showError('Please enter notice title and content to save as draft');
                return;
            }
            
            showSuccess('Notice saved as draft successfully!');
            addActivityLog('Saved Draft Notice', title, 'completed');
        }

        async function loadNoticesTable() {
            refreshNoticesBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            refreshNoticesBtn.disabled = true;
            
            try {
                const snapshot = await database.ref('notices').orderByChild('timestamp').once('value');
                
                notices = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const notice = childSnapshot.val();
                        notices.unshift(notice);
                    });
                }
                
                noticesTableBody.innerHTML = '';
                
                if (notices.length === 0) {
                    noticesTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No notices found</h3>
                                <p>Send your first notice using the "Send Notice" tab</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                notices.forEach(notice => {
                    const row = document.createElement('tr');
                    
                    const date = new Date(notice.timestamp);
                    const formattedDate = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    let priorityBadge = '';
                    if (notice.priority === 'high') {
                        priorityBadge = '<span class="priority-badge priority-high">High</span>';
                    } else if (notice.priority === 'medium') {
                        priorityBadge = '<span class="priority-badge priority-medium">Medium</span>';
                    } else {
                        priorityBadge = '<span class="priority-badge priority-low">Low</span>';
                    }
                    
                    let recipientsText = '';
                    if (notice.recipients?.teachers && notice.recipients?.students) {
                        recipientsText = 'All Teachers & Students';
                    } else if (notice.recipients?.teachers) {
                        recipientsText = 'Teachers Only';
                    } else if (notice.recipients?.students) {
                        recipientsText = 'Students Only';
                    }
                    
                    row.innerHTML = `
                        <td><strong>${notice.title}</strong></td>
                        <td>${notice.category || 'General'}</td>
                        <td>${priorityBadge}</td>
                        <td>${formattedDate}</td>
                        <td>${recipientsText}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm view-notice-btn" data-id="${notice.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-notice-btn" data-id="${notice.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    noticesTableBody.appendChild(row);
                });
                
                document.querySelectorAll('.delete-notice-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const noticeId = this.dataset.id;
                        showDeleteConfirmation('notice', noticeId, 'Are you sure you want to delete this notice?');
                    });
                });
                
                document.querySelectorAll('.view-notice-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const noticeId = this.dataset.id;
                        viewNotice(noticeId);
                    });
                });
                
            } catch (error) {
                console.error('Failed to load notices:', error);
                showError('Could not load notices from database. Using sample data.');
                
                noticesTableBody.innerHTML = '';
                
                if (notices.length === 0) {
                    noticesTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No notices found</h3>
                                <p>Send your first notice using the "Send Notice" tab</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                notices.forEach(notice => {
                    const row = document.createElement('tr');
                    
                    const date = new Date(notice.timestamp);
                    const formattedDate = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    let priorityBadge = '';
                    if (notice.priority === 'high') {
                        priorityBadge = '<span class="priority-badge priority-high">High</span>';
                    } else if (notice.priority === 'medium') {
                        priorityBadge = '<span class="priority-badge priority-medium">Medium</span>';
                    } else {
                        priorityBadge = '<span class="priority-badge priority-low">Low</span>';
                    }
                    
                    let recipientsText = '';
                    if (notice.recipients?.teachers && notice.recipients?.students) {
                        recipientsText = 'All Teachers & Students';
                    } else if (notice.recipients?.teachers) {
                        recipientsText = 'Teachers Only';
                    } else if (notice.recipients?.students) {
                        recipientsText = 'Students Only';
                    }
                    
                    row.innerHTML = `
                        <td><strong>${notice.title}</strong></td>
                        <td>${notice.category || 'General'}</td>
                        <td>${priorityBadge}</td>
                        <td>${formattedDate}</td>
                        <td>${recipientsText}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm view-notice-btn" data-id="${notice.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-danger btn-sm delete-notice-btn" data-id="${notice.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    noticesTableBody.appendChild(row);
                });
            } finally {
                refreshNoticesBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                refreshNoticesBtn.disabled = false;
            }
        }

        function viewNotice(noticeId) {
            const notice = notices.find(n => n.id === noticeId);
            if (!notice) return;
            
            alert(`Notice Details:\n\nTitle: ${notice.title}\n\nContent: ${notice.content}\n\nPriority: ${notice.priority}\n\nCategory: ${notice.category}\n\nSent to: ${notice.recipients?.teachers ? 'Teachers' : ''}${notice.recipients?.teachers && notice.recipients?.students ? ' & ' : ''}${notice.recipients?.students ? 'Students' : ''}\n\nDate: ${new Date(notice.timestamp).toLocaleString()}`);
        }

        // ============================
        // TEACHER MANAGEMENT FUNCTIONS
        // ============================
        async function loadTeachersTable() {
            try {
                const snapshot = await database.ref('teachers').once('value');
                
                teachers = [];
                let pendingCount = 0;
                
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const teacher = childSnapshot.val();
                        teacher.id = childSnapshot.key;
                        teachers.push(teacher);
                        
                        if (teacher.status === 'pending' || teacher.approved === false) {
                            pendingCount++;
                        }
                    });
                }
                
                pendingTeachersCount.textContent = pendingCount;
                
                let filteredTeachers = teachers;
                if (teacherFilter === 'pending') {
                    filteredTeachers = teachers.filter(t => 
                        t.status === 'pending' || t.approved === false
                    );
                }
                
                teachersTableBody.innerHTML = '';
                
                if (filteredTeachers.length === 0) {
                    teachersTableBody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No teachers found</h3>
                                <p>${teacherFilter === 'pending' ? 'No pending approval requests' : 'Add your first teacher using the "Add Teacher" button'}</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                filteredTeachers.forEach(teacher => {
                    const row = document.createElement('tr');
                    
                    let status = 'Pending';
                    let statusClass = 'status-pending';
                    
                    if (teacher.status === 'approved' || teacher.approved === true) {
                        status = 'Approved';
                        statusClass = 'status-approved';
                    } else if (teacher.status === 'rejected') {
                        status = 'Rejected';
                        statusClass = 'status-rejected';
                    }
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                ${teacher.profileImage && teacher.profileImage.startsWith('http') ? 
                                    `<img src="${teacher.profileImage}" alt="${teacher.fullName || teacher.name}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>';">` : 
                                    `<i class="fas fa-user"></i>`
                                }
                            </div>
                        </td>
                        <td><strong>${teacher.fullName || teacher.name}</strong></td>
                        <td>${teacher.subject || 'Not specified'}</td>
                        <td>${teacher.grade || 'Not specified'}</td>
                        <td>${teacher.phone || 'Not provided'}</td>
                        <td>${teacher.email || 'Not provided'}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <div class="action-buttons" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button class="view-btn view-teacher-btn" data-id="${teacher.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                ${(teacher.status === 'pending' || teacher.approved === false) ? `
                                <button class="approve-btn approval-action-btn" data-id="${teacher.id}" data-action="approve">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="reject-btn approval-action-btn" data-id="${teacher.id}" data-action="reject">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                ` : ''}
                                ${teacher.phone ? `
                                <a href="tel:${teacher.phone}" class="call-btn" target="_blank">
                                    <i class="fas fa-phone"></i> Call
                                </a>
                                ` : ''}
                                <button class="btn btn-danger btn-sm delete-teacher-btn" data-id="${teacher.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    teachersTableBody.appendChild(row);
                });
                
                document.querySelectorAll('.view-teacher-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const teacherId = this.dataset.id;
                        viewTeacherDetails(teacherId);
                    });
                });
                
                document.querySelectorAll('.approval-action-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const teacherId = this.dataset.id;
                        const action = this.dataset.action;
                        handleTeacherApproval(teacherId, action);
                    });
                });
                
                document.querySelectorAll('.delete-teacher-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const teacherId = this.dataset.id;
                        const teacher = teachers.find(t => t.id === teacherId);
                        const teacherName = teacher ? (teacher.fullName || teacher.name) : 'this teacher';
                        showDeleteConfirmation('teacher', teacherId, `Are you sure you want to delete ${teacherName}?`);
                    });
                });
                
            } catch (error) {
                console.error('Failed to load teachers:', error);
                showError('Could not load teachers from database. Using sample data.');
                
                teachersTableBody.innerHTML = '';
                
                let filteredTeachers = teachers;
                if (teacherFilter === 'pending') {
                    filteredTeachers = teachers.filter(t => 
                        t.status === 'pending' || t.approved === false
                    );
                }
                
                if (filteredTeachers.length === 0) {
                    teachersTableBody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No teachers found</h3>
                                <p>${teacherFilter === 'pending' ? 'No pending approval requests' : 'Add your first teacher using the "Add Teacher" button'}</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                filteredTeachers.forEach(teacher => {
                    const row = document.createElement('tr');
                    
                    let status = 'Pending';
                    let statusClass = 'status-pending';
                    
                    if (teacher.status === 'approved' || teacher.approved === true) {
                        status = 'Approved';
                        statusClass = 'status-approved';
                    } else if (teacher.status === 'rejected') {
                        status = 'Rejected';
                        statusClass = 'status-rejected';
                    }
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                <i class="fas fa-user"></i>
                            </div>
                        </td>
                        <td><strong>${teacher.fullName || teacher.name}</strong></td>
                        <td>${teacher.subject || 'Not specified'}</td>
                        <td>${teacher.grade || 'Not specified'}</td>
                        <td>${teacher.phone || 'Not provided'}</td>
                        <td>${teacher.email || 'Not provided'}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <div class="action-buttons" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button class="view-btn view-teacher-btn" data-id="${teacher.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                ${(teacher.status === 'pending' || teacher.approved === false) ? `
                                <button class="approve-btn approval-action-btn" data-id="${teacher.id}" data-action="approve">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="reject-btn approval-action-btn" data-id="${teacher.id}" data-action="reject">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                ` : ''}
                                ${teacher.phone ? `
                                <a href="tel:${teacher.phone}" class="call-btn" target="_blank">
                                    <i class="fas fa-phone"></i> Call
                                </a>
                                ` : ''}
                                <button class="btn btn-danger btn-sm delete-teacher-btn" data-id="${teacher.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    teachersTableBody.appendChild(row);
                });
            }
        }

        async function viewTeacherDetails(teacherId) {
            try {
                const snapshot = await database.ref('teachers/' + teacherId).once('value');
                
                if (!snapshot.exists()) {
                    showError('Teacher not found');
                    return;
                }
                
                const teacher = snapshot.val();
                teacher.id = teacherId;
                
                const createdAt = teacher.createdAt ? new Date(teacher.createdAt).toLocaleString() : 'Not available';
                const updatedAt = teacher.updatedAt ? new Date(teacher.updatedAt).toLocaleString() : 'Not available';
                
                let status = 'Pending';
                let statusClass = 'status-pending';
                
                if (teacher.status === 'approved' || teacher.approved === true) {
                    status = 'Approved';
                    statusClass = 'status-approved';
                } else if (teacher.status === 'rejected') {
                    status = 'Rejected';
                    statusClass = 'status-rejected';
                }
                
                teacherDetailsContent.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 25px;">
                        <div style="display: flex; gap: 25px; align-items: center;">
                            <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%); display: flex; align-items: center; justify-content: center; border: 4px solid var(--light);">
                                ${teacher.profileImage && teacher.profileImage.startsWith('http') ? 
                                    `<img src="${teacher.profileImage}" alt="${teacher.fullName || teacher.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\' style=\\'font-size: 48px; color: white;\\'></i>';">` : 
                                    `<i class="fas fa-user" style="font-size: 48px; color: white;"></i>`
                                }
                            </div>
                            <div>
                                <h2 style="color: var(--primary); margin-bottom: 10px;">${teacher.fullName || teacher.name}</h2>
                                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                    <span class="status-badge ${statusClass}" style="font-size: 16px;">${status}</span>
                                    <span style="background-color: rgba(52, 152, 219, 0.1); color: var(--secondary); padding: 6px 15px; border-radius: 20px; font-weight: 600;">
                                        ${teacher.subject || 'Not specified'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Grade/Class</h4>
                                <p style="font-size: 18px; font-weight: 600;">${teacher.grade || 'Not specified'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">User ID</h4>
                                <p style="font-size: 14px; font-family: monospace;">${teacher.uid || teacher.id}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Phone Number</h4>
                                <p style="font-size: 18px; font-weight: 600;">${teacher.phone || 'Not provided'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Email</h4>
                                <p>${teacher.email || 'Not provided'}</p>
                            </div>
                        </div>
                        
                        <div style="border-top: 1px solid var(--light); padding-top: 20px;">
                            <h4 style="color: var(--gray); margin-bottom: 15px;">Account Information</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Created At</h5>
                                    <p>${createdAt}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Last Updated</h5>
                                    <p>${updatedAt}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Approval Status</h5>
                                    <p>${teacher.approved === true ? 'Approved' : teacher.approved === false ? 'Not Approved' : 'Pending'}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Role</h5>
                                    <p>${teacher.role || 'teacher'}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${(teacher.status === 'pending' || teacher.approved === false) ? `
                        <div style="display: flex; gap: 15px; justify-content: center; padding-top: 20px; border-top: 1px solid var(--light);">
                            <button class="btn btn-success" id="approveTeacherBtn" style="flex: 1;" data-id="${teacherId}">
                                <i class="fas fa-check"></i> Approve Teacher
                            </button>
                            <button class="btn btn-danger" id="rejectTeacherBtn" style="flex: 1;" data-id="${teacherId}">
                                <i class="fas fa-times"></i> Reject Request
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                const approveBtn = document.getElementById('approveTeacherBtn');
                const rejectBtn = document.getElementById('rejectTeacherBtn');
                
                if (approveBtn) {
                    approveBtn.addEventListener('click', function() {
                        const teacherId = this.dataset.id;
                        handleTeacherApproval(teacherId, 'approve');
                        teacherDetailsModal.style.display = 'none';
                    });
                }
                
                if (rejectBtn) {
                    rejectBtn.addEventListener('click', function() {
                        const teacherId = this.dataset.id;
                        handleTeacherApproval(teacherId, 'reject');
                        teacherDetailsModal.style.display = 'none';
                    });
                }
                
                teacherDetailsModal.style.display = 'flex';
                
            } catch (error) {
                showError('Failed to load teacher details: ' + error.message);
            }
        }

        async function handleTeacherApproval(teacherId, action) {
            try {
                const confirmation = confirm(`Are you sure you want to ${action} this teacher?`);
                if (!confirmation) return;
                
                const updates = {
                    status: action === 'approve' ? 'approved' : 'rejected',
                    approved: action === 'approve' ? true : false,
                    updatedAt: new Date().toISOString(),
                    reviewedBy: currentUser.uid,
                    reviewedByName: currentAdmin?.name || currentUser.displayName || 'Admin',
                    reviewedAt: new Date().toISOString()
                };
                
                await database.ref('teachers/' + teacherId).update(updates);
                
                const teacherIndex = teachers.findIndex(t => t.id === teacherId);
                if (teacherIndex !== -1) {
                    teachers[teacherIndex] = { ...teachers[teacherIndex], ...updates };
                }
                
                const actionText = action === 'approve' ? 'approved' : 'rejected';
                showSuccess(`Teacher request has been ${actionText} successfully!`);
                
                const teacher = teachers.find(t => t.id === teacherId);
                const teacherName = teacher ? (teacher.fullName || teacher.name) : 'Teacher';
                
                // Add activity log
                addActivityLog(
                    `${action === 'approve' ? 'Approved' : 'Rejected'} Teacher`, 
                    `${teacherName} - ${actionText}`, 
                    'completed'
                );
                
                loadTeachersTable();
                loadDashboardData();
                
            } catch (error) {
                showError(`Failed to ${action} teacher: ` + error.message);
                addActivityLog(
                    `Failed to ${action} Teacher`, 
                    `Teacher ID: ${teacherId}`, 
                    'failed'
                );
            }
        }

        async function saveTeacher() {
            const name = document.getElementById('teacherName').value;
            const subject = document.getElementById('teacherSubject').value;
            const grade = document.getElementById('teacherGrade').value;
            const phone = document.getElementById('teacherPhone').value;
            const email = document.getElementById('teacherEmail').value;
            
            if (!name || !subject || !phone) {
                showError('Please fill all required fields (Name, Subject, Phone)');
                return;
            }
            
            const btn = saveTeacherBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            btn.disabled = true;
            
            try {
                const teacherId = database.ref().child('teachers').push().key;
                const teacherData = {
                    id: teacherId,
                    name: name,
                    subject: subject,
                    grade: grade,
                    phone: phone,
                    email: email,
                    status: 'approved',
                    approved: true,
                    addedDate: new Date().toISOString(),
                    addedBy: currentUser.uid,
                    addedByName: currentAdmin?.name || currentUser.displayName || 'Admin',
                    updatedAt: new Date().toISOString(),
                    role: 'teacher'
                };
                
                await database.ref('teachers/' + teacherId).set(teacherData);
                
                showSuccess('Teacher added successfully!');
                
                teachers.push(teacherData);
                document.getElementById('addTeacherModal').style.display = 'none';
                loadDashboardData();
                
                if (document.getElementById('manageTeachersSection').style.display === 'block') {
                    loadTeachersTable();
                }
                
                clearTeacherForm();
                
                // Add activity log
                addActivityLog('Added Teacher', `${name} - ${subject}`, 'completed');
                
            } catch (error) {
                showError('Failed to add teacher: ' + error.message);
                addActivityLog('Failed to Add Teacher', name, 'failed');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function clearTeacherForm() {
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubject').value = '';
            document.getElementById('teacherGrade').value = '';
            document.getElementById('teacherPhone').value = '';
            document.getElementById('teacherEmail').value = '';
        }

        // ============================
        // NEW: STUDENT MANAGEMENT FUNCTIONS
        // ============================
        async function loadStudentsTable() {
            try {
                refreshStudentsBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                refreshStudentsBtn.disabled = true;
                
                const snapshot = await database.ref('students').once('value');
                
                students = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const student = childSnapshot.val();
                        student.id = childSnapshot.key;
                        students.push(student);
                    });
                }
                
                studentsTableBody.innerHTML = '';
                
                if (students.length === 0) {
                    studentsTableBody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-user-graduate" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No students found</h3>
                                <p>Students will appear here when they register in the app</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                students.forEach(student => {
                    const row = document.createElement('tr');
                    
                    let status = 'Pending';
                    let statusClass = 'status-pending';
                    
                    if (student.status === 'approved') {
                        status = 'Approved';
                        statusClass = 'status-approved';
                    } else if (student.status === 'rejected') {
                        status = 'Rejected';
                        statusClass = 'status-rejected';
                    }
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                ${student.profileImage && student.profileImage.startsWith('http') ? 
                                    `<img src="${student.profileImage}" alt="${student.fullName}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>';">` : 
                                    `<i class="fas fa-user"></i>`
                                }
                            </div>
                        </td>
                        <td><strong>${student.fullName || 'Unknown'}</strong></td>
                        <td>${student.rollNumber || 'N/A'}</td>
                        <td>${student.grade || ''} ${student.section ? `- ${student.section}` : ''}</td>
                        <td>${student.parentName || 'Not provided'}</td>
                        <td>${student.phone || 'Not provided'}</td>
                        <td>${student.email || 'Not provided'}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <div class="action-buttons" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button class="view-btn view-student-btn" data-id="${student.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                ${student.status === 'pending' ? `
                                <button class="approve-btn approval-action-btn" data-id="${student.id}" data-action="approve" data-type="student">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="reject-btn approval-action-btn" data-id="${student.id}" data-action="reject" data-type="student">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                ` : ''}
                                ${student.phone ? `
                                <a href="tel:${student.phone}" class="call-btn" target="_blank">
                                    <i class="fas fa-phone"></i> Call
                                </a>
                                ` : ''}
                                <button class="btn btn-danger btn-sm delete-student-btn" data-id="${student.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    studentsTableBody.appendChild(row);
                });
                
                document.querySelectorAll('.view-student-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const studentId = this.dataset.id;
                        viewStudentDetails(studentId);
                    });
                });
                
                document.querySelectorAll('.approval-action-btn[data-type="student"]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const studentId = this.dataset.id;
                        const action = this.dataset.action;
                        handleStudentApproval(studentId, action);
                    });
                });
                
                document.querySelectorAll('.delete-student-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const studentId = this.dataset.id;
                        const student = students.find(s => s.id === studentId);
                        const studentName = student ? student.fullName : 'this student';
                        showDeleteConfirmation('student', studentId, `Are you sure you want to delete ${studentName}?`);
                    });
                });
                
            } catch (error) {
                console.error('Failed to load students:', error);
                showError('Could not load students from database. Using sample data.');
                
                studentsTableBody.innerHTML = '';
                
                if (students.length === 0) {
                    studentsTableBody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-user-graduate" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No students found</h3>
                                <p>Students will appear here when they register in the app</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                students.forEach(student => {
                    const row = document.createElement('tr');
                    
                    let status = 'Pending';
                    let statusClass = 'status-pending';
                    
                    if (student.status === 'approved') {
                        status = 'Approved';
                        statusClass = 'status-approved';
                    } else if (student.status === 'rejected') {
                        status = 'Rejected';
                        statusClass = 'status-rejected';
                    }
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                <i class="fas fa-user"></i>
                            </div>
                        </td>
                        <td><strong>${student.fullName || 'Unknown'}</strong></td>
                        <td>${student.rollNumber || 'N/A'}</td>
                        <td>${student.grade || ''} ${student.section ? `- ${student.section}` : ''}</td>
                        <td>${student.parentName || 'Not provided'}</td>
                        <td>${student.phone || 'Not provided'}</td>
                        <td>${student.email || 'Not provided'}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>
                            <div class="action-buttons" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button class="view-btn view-student-btn" data-id="${student.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                ${student.status === 'pending' ? `
                                <button class="approve-btn approval-action-btn" data-id="${student.id}" data-action="approve" data-type="student">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="reject-btn approval-action-btn" data-id="${student.id}" data-action="reject" data-type="student">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                ` : ''}
                                ${student.phone ? `
                                <a href="tel:${student.phone}" class="call-btn" target="_blank">
                                    <i class="fas fa-phone"></i> Call
                                </a>
                                ` : ''}
                                <button class="btn btn-danger btn-sm delete-student-btn" data-id="${student.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    studentsTableBody.appendChild(row);
                });
            } finally {
                refreshStudentsBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                refreshStudentsBtn.disabled = false;
            }
        }

        async function viewStudentDetails(studentId) {
            try {
                const snapshot = await database.ref('students/' + studentId).once('value');
                
                if (!snapshot.exists()) {
                    showError('Student not found');
                    return;
                }
                
                const student = snapshot.val();
                student.id = studentId;
                
                const registrationDate = student.registrationDate || 'Not available';
                const updatedAt = student.updatedAt ? new Date(student.updatedAt).toLocaleString() : 'Not available';
                const dateOfBirth = student.dateOfBirth || 'Not provided';
                
                let status = 'Pending';
                let statusClass = 'status-pending';
                
                if (student.status === 'approved') {
                    status = 'Approved';
                    statusClass = 'status-approved';
                } else if (student.status === 'rejected') {
                    status = 'Rejected';
                    statusClass = 'status-rejected';
                }
                
                studentDetailsContent.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 25px;">
                        <div style="display: flex; gap: 25px; align-items: center;">
                            <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%); display: flex; align-items: center; justify-content: center; border: 4px solid var(--light);">
                                ${student.profileImage && student.profileImage.startsWith('http') ? 
                                    `<img src="${student.profileImage}" alt="${student.fullName}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\' style=\\'font-size: 48px; color: white;\\'></i>';">` : 
                                    `<i class="fas fa-user" style="font-size: 48px; color: white;"></i>`
                                }
                            </div>
                            <div>
                                <h2 style="color: var(--primary); margin-bottom: 10px;">${student.fullName || 'Unknown'}</h2>
                                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                    <span class="status-badge ${statusClass}" style="font-size: 16px;">${status}</span>
                                    <span style="background-color: rgba(52, 152, 219, 0.1); color: var(--secondary); padding: 6px 15px; border-radius: 20px; font-weight: 600;">
                                        ${student.grade || ''} ${student.section ? `- ${student.section}` : ''}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Roll Number</h4>
                                <p style="font-size: 18px; font-weight: 600;">${student.rollNumber || 'N/A'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Student ID</h4>
                                <p style="font-size: 14px; font-family: monospace;">${student.studentId || student.id}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Date of Birth</h4>
                                <p>${dateOfBirth}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Teacher ID</h4>
                                <p style="font-size: 14px; font-family: monospace;">${student.teacherId || 'Not assigned'}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Parent Name</h4>
                                <p style="font-size: 18px; font-weight: 600;">${student.parentName || 'Not provided'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Phone Number</h4>
                                <p>${student.phone || 'Not provided'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Email</h4>
                                <p>${student.email || 'Not provided'}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--gray); margin-bottom: 8px;">Address</h4>
                                <p>${student.address || 'Not provided'}</p>
                            </div>
                        </div>
                        
                        <div style="border-top: 1px solid var(--light); padding-top: 20px;">
                            <h4 style="color: var(--gray); margin-bottom: 15px;">Account Information</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Registration Date</h5>
                                    <p>${registrationDate}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Last Updated</h5>
                                    <p>${updatedAt}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Approval Status</h5>
                                    <p>${status}</p>
                                </div>
                                <div>
                                    <h5 style="color: var(--gray); margin-bottom: 5px;">Email Verified</h5>
                                    <p>${student.emailVerified ? 'Yes' : 'No'}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${student.status === 'pending' ? `
                        <div style="display: flex; gap: 15px; justify-content: center; padding-top: 20px; border-top: 1px solid var(--light);">
                            <button class="btn btn-success" id="approveStudentBtn" style="flex: 1;" data-id="${studentId}">
                                <i class="fas fa-check"></i> Approve Student
                            </button>
                            <button class="btn btn-danger" id="rejectStudentBtn" style="flex: 1;" data-id="${studentId}">
                                <i class="fas fa-times"></i> Reject Request
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                const approveBtn = document.getElementById('approveStudentBtn');
                const rejectBtn = document.getElementById('rejectStudentBtn');
                
                if (approveBtn) {
                    approveBtn.addEventListener('click', function() {
                        const studentId = this.dataset.id;
                        handleStudentApproval(studentId, 'approve');
                        studentDetailsModal.style.display = 'none';
                    });
                }
                
                if (rejectBtn) {
                    rejectBtn.addEventListener('click', function() {
                        const studentId = this.dataset.id;
                        handleStudentApproval(studentId, 'reject');
                        studentDetailsModal.style.display = 'none';
                    });
                }
                
                studentDetailsModal.style.display = 'flex';
                
            } catch (error) {
                showError('Failed to load student details: ' + error.message);
            }
        }

        async function handleStudentApproval(studentId, action) {
            try {
                const confirmation = confirm(`Are you sure you want to ${action} this student?`);
                if (!confirmation) return;
                
                const updates = {
                    status: action === 'approve' ? 'approved' : 'rejected',
                    updatedAt: new Date().toISOString(),
                    reviewedBy: currentUser.uid,
                    reviewedByName: currentAdmin?.name || currentUser.displayName || 'Admin',
                    reviewedAt: new Date().toISOString()
                };
                
                await database.ref('students/' + studentId).update(updates);
                
                const studentIndex = students.findIndex(s => s.id === studentId);
                if (studentIndex !== -1) {
                    students[studentIndex] = { ...students[studentIndex], ...updates };
                }
                
                const actionText = action === 'approve' ? 'approved' : 'rejected';
                showSuccess(`Student has been ${actionText} successfully!`);
                
                const student = students.find(s => s.id === studentId);
                const studentName = student ? student.fullName : 'Student';
                
                // Add activity log
                addActivityLog(
                    `${action === 'approve' ? 'Approved' : 'Rejected'} Student`, 
                    `${studentName} - ${actionText}`, 
                    'completed'
                );
                
                loadStudentsTable();
                loadDashboardData();
                
            } catch (error) {
                showError(`Failed to ${action} student: ` + error.message);
                addActivityLog(
                    `Failed to ${action} Student`, 
                    `Student ID: ${studentId}`, 
                    'failed'
                );
            }
        }

        // ============================
        // ADMIN MANAGEMENT FUNCTIONS
        // ============================
        async function loadAdminsTable() {
            try {
                const snapshot = await database.ref('admins').once('value');
                
                admins = [];
                
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const admin = childSnapshot.val();
                        admin.id = childSnapshot.key;
                        admins.push(admin);
                    });
                }
                
                adminCount.textContent = admins.length;
                
                adminsTableBody.innerHTML = '';
                
                if (admins.length === 0) {
                    adminsTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-user-shield" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                                <h3>No admins found</h3>
                                <p>Add your first admin using the "Add Admin" button</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                admins.forEach(admin => {
                    const row = document.createElement('tr');
                    
                    const statusBadge = admin.status === 'active' 
                        ? '<span class="status-badge status-active">Active</span>' 
                        : '<span class="status-badge status-inactive">Inactive</span>';
                    
                    const roleDisplay = admin.role === 'super_admin' ? 'Super Admin' : 'Admin';
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                ${admin.profileImage && (admin.profileImage.startsWith('http') || admin.profileImage.startsWith('blob')) ? 
                                    `<img src="${admin.profileImage}" alt="${admin.name}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>';">` : 
                                    `<i class="fas fa-user"></i>`
                                }
                            </div>
                        </td>
                        <td><strong>${admin.name}</strong></td>
                        <td>${admin.email}</td>
                        <td>${roleDisplay}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm edit-admin-btn" data-id="${admin.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${admin.id !== currentUser?.uid ? `
                                <button class="btn btn-danger btn-sm delete-admin-btn" data-id="${admin.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    
                    adminsTableBody.appendChild(row);
                });
                
                document.querySelectorAll('.edit-admin-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const adminId = this.dataset.id;
                        editAdmin(adminId);
                    });
                });
                
                document.querySelectorAll('.delete-admin-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const adminId = this.dataset.id;
                        const admin = admins.find(a => a.id === adminId);
                        const adminName = admin ? admin.name : 'this admin';
                        showDeleteConfirmation('admin', adminId, `Are you sure you want to delete ${adminName}?`);
                    });
                });
                
            } catch (error) {
                console.error('Failed to load admins:', error);
                showError('Could not load admins from database. Using sample data.');
                
                adminCount.textContent = admins.length;
                adminsTableBody.innerHTML = '';
                
                const sampleAdmins = [
                    {
                        id: 'BJc2OteAUtXeO3ddrfsJP102iNy2',
                        name: 'VIJAY KUMAR',
                        email: 'vijaygond2024@gmail.com',
                        role: 'super_admin',
                        status: 'active',
                        profileImage: 'blob:https://swayamvarapp26-oss.github.io/f27d4ee4-3a89-464a-9e05-cb97eeeb251b',
                        createdAt: '2026-01-12T08:46:17.614Z',
                        createdBy: 'BJc2OteAUtXeO3ddrfsJP102iNy2',
                        createdByName: 'VIJAY',
                        lastLogin: '2026-01-12T16:43:25.792Z',
                        updatedAt: '2026-01-12T08:58:33.087Z'
                    }
                ];
                
                sampleAdmins.forEach(admin => {
                    const row = document.createElement('tr');
                    
                    const statusBadge = admin.status === 'active' 
                        ? '<span class="status-badge status-active">Active</span>' 
                        : '<span class="status-badge status-inactive">Inactive</span>';
                    
                    const roleDisplay = admin.role === 'super_admin' ? 'Super Admin' : 'Admin';
                    
                    row.innerHTML = `
                        <td>
                            <div class="profile-image-container">
                                ${admin.profileImage ? 
                                    `<img src="${admin.profileImage}" alt="${admin.name}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>';">` : 
                                    `<i class="fas fa-user"></i>`
                                }
                            </div>
                        </td>
                        <td><strong>${admin.name}</strong></td>
                        <td>${admin.email}</td>
                        <td>${roleDisplay}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm edit-admin-btn" data-id="${admin.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${admin.id !== currentUser?.uid ? `
                                <button class="btn btn-danger btn-sm delete-admin-btn" data-id="${admin.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    
                    adminsTableBody.appendChild(row);
                });
            }
        }

        async function saveAdmin() {
            const name = document.getElementById('adminNameInput').value;
            const email = document.getElementById('adminEmailInput').value;
            const role = document.getElementById('adminRoleSelect').value;
            const status = document.getElementById('adminStatusSelect').value;
            const password = document.getElementById('adminPasswordInput').value;
            
            if (!name || !email || !password) {
                showError('Please fill all required fields (Name, Email, Password)');
                return;
            }
            
            let requirements = [];
            if (password.length < 6) requirements.push('at least 6 characters');
            if (!/[a-z]/.test(password)) requirements.push('one lowercase letter');
            if (!/[A-Z]/.test(password)) requirements.push('one uppercase letter');
            if (!/[0-9]/.test(password)) requirements.push('one number');
            
            if (requirements.length > 0) {
                showError('Password must contain: ' + requirements.join(', '));
                return;
            }
            
            const btn = saveAdminBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            btn.disabled = true;
            
            try {
                const methods = await auth.fetchSignInMethodsForEmail(email);
                if (methods.length > 0) {
                    showError('Email already registered. Please use a different email.');
                    return;
                }
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                const adminData = {
                    name: name,
                    email: email,
                    role: role,
                    status: status,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.uid,
                    createdByName: currentAdmin?.name || currentUser.displayName || 'Admin'
                };
                
                try {
                    await database.ref('admins/' + userCredential.user.uid).set(adminData);
                } catch (dbError) {
                    console.warn('Could not save admin to database:', dbError);
                }
                
                try {
                    await sendWelcomeEmail(email, name, password);
                } catch (emailError) {
                    console.warn('Failed to send welcome email:', emailError);
                }
                
                showSuccess('Admin created successfully! Welcome email sent.');
                
                document.getElementById('addAdminModal').style.display = 'none';
                loadDashboardData();
                
                if (document.getElementById('manageAdminsSection').style.display === 'block') {
                    loadAdminsTable();
                }
                
                clearAdminForm();
                
                // Add activity log
                addActivityLog('Added Admin', `${name} - ${role}`, 'completed');
                
            } catch (error) {
                showError('Failed to create admin: ' + error.message);
                addActivityLog('Failed to Add Admin', name, 'failed');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function sendWelcomeEmail(email, name, password) {
            try {
                const templateParams = {
                    to_email: email,
                    admin_name: name,
                    admin_email: email,
                    admin_password: password,
                    login_url: window.location.origin,
                    date: new Date().toLocaleDateString()
                };

                await emailjs.send(
                    EMAILJS_CONFIG.SERVICE_ID,
                    'template_xyk8468',
                    templateParams
                );
                
                return true;
            } catch (error) {
                console.error('Welcome email error:', error);
                return false;
            }
        }

        function editAdmin(adminId) {
            const admin = admins.find(a => a.id === adminId);
            if (!admin) return;
            
            alert(`Edit Admin: ${admin.name}\n\nEmail: ${admin.email}\nRole: ${admin.role}\nStatus: ${admin.status}\n\nEdit functionality to be implemented.`);
        }

        function clearAdminForm() {
            document.getElementById('adminNameInput').value = '';
            document.getElementById('adminEmailInput').value = '';
            document.getElementById('adminRoleSelect').value = 'admin';
            document.getElementById('adminStatusSelect'). value = 'active';
            document.getElementById('adminPasswordInput').value = '';
        }

        // ============================
        // DEVELOPER DATA MANAGEMENT FUNCTIONS
        // ============================
        async function loadDeveloperData() {
            try {
                refreshDeveloperDataBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                refreshDeveloperDataBtn.disabled = true;
                
                const snapshot = await database.ref('developer_data').orderByChild('createdAt').once('value');
                
                developerData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        data.id = childSnapshot.key;
                        developerData.unshift(data);
                    });
                }
                
                developerDataCountElement.textContent = developerData.length;
                
                developerDataList.innerHTML = '';
                
                if (developerData.length === 0) {
                    developerDataList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-database" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                            <h3>No data found</h3>
                            <p>Add your first data item using the form above</p>
                        </div>
                    `;
                    return;
                }
                
                developerData.forEach(item => {
                    const dataItem = document.createElement('div');
                    dataItem.className = 'link-item';
                    dataItem.dataset.id = item.id;
                    
                    const date = new Date(item.createdAt);
                    const formattedDate = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    let categoryBadge = '';
                    if (item.category === 'important') {
                        categoryBadge = '<span class="category-badge category-important">Important</span>';
                    } else if (item.category === 'resource') {
                        categoryBadge = '<span class="category-badge category-resource">Resource</span>';
                    } else if (item.category === 'tutorial') {
                        categoryBadge = '<span class="category-badge category-tutorial">Tutorial</span>';
                    } else {
                        categoryBadge = '<span class="category-badge category-general">General</span>';
                    }
                    
                    let priorityBadge = '';
                    if (item.priority === 'high') {
                        priorityBadge = '<span class="priority-badge priority-high">High Priority</span>';
                    } else if (item.priority === 'medium') {
                        priorityBadge = '<span class="priority-badge priority-medium">Medium Priority</span>';
                    } else {
                        priorityBadge = '<span class="priority-badge priority-low">Low Priority</span>';
                    }
                    
                    dataItem.innerHTML = `
                        <div class="link-title">
                            <span>${item.title}</span>
                            <span style="font-size: 14px; color: var(--gray);">${formattedDate}</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            ${categoryBadge}
                            ${priorityBadge}
                        </div>
                        <div class="link-description">${item.description}</div>
                        <a href="${item.link}" target="_blank" class="link-url">
                            <i class="fas fa-external-link-alt"></i>
                            ${item.link}
                        </a>
                        <div class="link-actions">
                            <button class="btn btn-secondary btn-sm edit-developer-data-btn" data-id="${item.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm delete-developer-data-btn" data-id="${item.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                    
                    developerDataList.appendChild(dataItem);
                });
                
                document.querySelectorAll('.delete-developer-data-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const dataId = this.dataset.id;
                        const dataItem = developerData.find(d => d.id === dataId);
                        const itemTitle = dataItem ? dataItem.title : 'this item';
                        showDeleteConfirmation('developer_data', dataId, `Are you sure you want to delete "${itemTitle}"?`);
                    });
                });
                
                document.querySelectorAll('.edit-developer-data-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const dataId = this.dataset.id;
                        editDeveloperData(dataId);
                    });
                });
                
            } catch (error) {
                console.error('Failed to load developer data:', error);
                showError('Could not load developer data from database.');
                
                developerDataList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-database" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                        <h3>No data found</h3>
                        <p>Add your first data item using the form above</p>
                    </div>
                `;
            } finally {
                refreshDeveloperDataBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
                refreshDeveloperDataBtn.disabled = false;
            }
        }

        async function saveDeveloperData() {
            const title = document.getElementById('dataTitle').value;
            const description = document.getElementById('dataDescription').value;
            const link = document.getElementById('dataLink').value;
            const category = document.getElementById('dataCategory').value;
            const priority = document.getElementById('dataPriority').value;
            
            if (!title || !description || !link) {
                showError('Please fill all required fields (Title, Description, Link)');
                return;
            }
            
            try {
                new URL(link);
            } catch (error) {
                showError('Please enter a valid URL (starting with http:// or https://)');
                return;
            }
            
            const btn = saveDeveloperDataBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            btn.disabled = true;
            
            try {
                // First, try to save to localStorage as a fallback
                const dataId = 'dev_' + Date.now();
                const dataItem = {
                    id: dataId,
                    title: title,
                    description: description,
                    link: link,
                    category: category,
                    priority: priority,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.uid,
                    createdByName: currentAdmin?.name || currentUser.displayName || 'Admin',
                    updatedAt: new Date().toISOString(),
                    source: 'localStorage' // Mark as saved locally
                };
                
                // Save to localStorage
                const savedItems = JSON.parse(localStorage.getItem('developer_data') || '[]');
                savedItems.unshift(dataItem);
                localStorage.setItem('developer_data', JSON.stringify(savedItems));
                
                // Try to save to Firebase (but don't fail if it doesn't work)
                try {
                    const firebaseId = database.ref().child('developer_data').push().key;
                    await database.ref('developer_data/' + firebaseId).set({
                        ...dataItem,
                        id: firebaseId,
                        source: 'firebase'
                    });
                } catch (firebaseError) {
                    console.warn('Could not save to Firebase, using localStorage only:', firebaseError);
                }
                
                showSuccess('Data saved successfully! (Stored locally)');
                
                developerData.unshift(dataItem);
                loadDashboardData();
                clearDeveloperDataForm();
                loadDeveloperData();
                
                // Add activity log
                addActivityLog('Added Developer Data', title, 'completed');
                
            } catch (error) {
                console.error('Failed to save data:', error);
                showError('Failed to save data: ' + error.message + ' (Data saved locally instead)');
                
                // Even if everything fails, save to localStorage
                try {
                    const dataId = 'dev_local_' + Date.now();
                    const dataItem = {
                        id: dataId,
                        title: title,
                        description: description,
                        link: link,
                        category: category,
                        priority: priority,
                        createdAt: new Date().toISOString(),
                        createdBy: currentUser.uid,
                        createdByName: currentAdmin?.name || currentUser.displayName || 'Admin',
                        updatedAt: new Date().toISOString(),
                        source: 'localStorage_fallback'
                    };
                    
                    const savedItems = JSON.parse(localStorage.getItem('developer_data') || '[]');
                    savedItems.unshift(dataItem);
                    localStorage.setItem('developer_data', JSON.stringify(savedItems));
                    
                    developerData.unshift(dataItem);
                    loadDeveloperData();
                } catch (localError) {
                    console.error('Even localStorage failed:', localError);
                }
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function editDeveloperData(dataId) {
            const dataItem = developerData.find(d => d.id === dataId);
            if (!dataItem) return;
            
            const newTitle = prompt('Enter new title:', dataItem.title);
            if (newTitle === null) return;
            
            const newDescription = prompt('Enter new description:', dataItem.description);
            if (newDescription === null) return;
            
            const newLink = prompt('Enter new link:', dataItem.link);
            if (newLink === null) return;
            
            try {
                new URL(newLink);
            } catch (error) {
                showError('Please enter a valid URL (starting with http:// or https://)');
                return;
            }
            
            try {
                const updates = {
                    title: newTitle,
                    description: newDescription,
                    link: newLink,
                    updatedAt: new Date().toISOString()
                };
                
                // Try to update in Firebase
                try {
                    await database.ref('developer_data/' + dataId).update(updates);
                } catch (firebaseError) {
                    console.warn('Could not update in Firebase, updating localStorage:', firebaseError);
                }
                
                // Always update localStorage
                const savedItems = JSON.parse(localStorage.getItem('developer_data') || '[]');
                const itemIndex = savedItems.findIndex(item => item.id === dataId);
                if (itemIndex !== -1) {
                    savedItems[itemIndex] = { ...savedItems[itemIndex], ...updates };
                    localStorage.setItem('developer_data', JSON.stringify(savedItems));
                }
                
                // Update local state
                const index = developerData.findIndex(d => d.id === dataId);
                if (index !== -1) {
                    developerData[index] = { ...developerData[index], ...updates };
                }
                
                showSuccess('Data updated successfully!');
                loadDeveloperData();
                
                // Add activity log
                addActivityLog('Updated Developer Data', newTitle, 'completed');
                
            } catch (error) {
                showError('Failed to update data: ' + error.message);
                addActivityLog('Failed to Update Developer Data', newTitle, 'failed');
            }
        }

        function clearDeveloperDataForm() {
            document.getElementById('dataTitle').value = '';
            document.getElementById('dataDescription').value = '';
            document.getElementById('dataLink').value = '';
            document.getElementById('dataCategory').value = 'general';
            document.getElementById('dataPriority').value = 'low';
        }

        // ============================
        // DELETE FUNCTIONS
        // ============================
        function showDeleteConfirmation(type, id, message) {
            itemToDelete = id;
            deleteType = type;
            
            document.getElementById('deleteMessage').textContent = message;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        async function confirmDelete() {
            if (!itemToDelete || !deleteType) return;
            
            confirmDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
            confirmDeleteBtn.disabled = true;
            
            try {
                if (deleteType === 'notice') {
                    try {
                        await database.ref('notices/' + itemToDelete).remove();
                    } catch (error) {
                        console.warn('Could not delete notice from database:', error);
                    }
                    
                    const index = notices.findIndex(n => n.id === itemToDelete);
                    if (index !== -1) {
                        const noticeTitle = notices[index].title;
                        notices.splice(index, 1);
                        showSuccess(`Notice "${noticeTitle}" deleted successfully!`);
                        
                        // Add activity log
                        addActivityLog('Deleted Notice', noticeTitle, 'completed');
                    }
                    
                } else if (deleteType === 'teacher') {
                    try {
                        await database.ref('teachers/' + itemToDelete).remove();
                    } catch (error) {
                        console.warn('Could not delete teacher from database:', error);
                    }
                    
                    const index = teachers.findIndex(t => t.id === itemToDelete);
                    if (index !== -1) {
                        const teacherName = teachers[index].name;
                        teachers.splice(index, 1);
                        showSuccess(`Teacher "${teacherName}" deleted successfully!`);
                        
                        // Add activity log
                        addActivityLog('Deleted Teacher', teacherName, 'completed');
                    }
                    
                } else if (deleteType === 'student') {
                    try {
                        await database.ref('students/' + itemToDelete).remove();
                    } catch (error) {
                        console.warn('Could not delete student from database:', error);
                    }
                    
                    const index = students.findIndex(s => s.id === itemToDelete);
                    if (index !== -1) {
                        const studentName = students[index].fullName;
                        students.splice(index, 1);
                        showSuccess(`Student "${studentName}" deleted successfully!`);
                        
                        // Add activity log
                        addActivityLog('Deleted Student', studentName, 'completed');
                    }
                    
                } else if (deleteType === 'admin') {
                    if (itemToDelete === currentUser?.uid) {
                        showError('You cannot delete your own account!');
                        return;
                    }
                    
                    try {
                        await database.ref('admins/' + itemToDelete).remove();
                    } catch (error) {
                        console.warn('Could not delete admin from database:', error);
                    }
                    
                    const index = admins.findIndex(a => a.id === itemToDelete);
                    if (index !== -1) {
                        const adminName = admins[index].name;
                        admins.splice(index, 1);
                        showSuccess(`Admin "${adminName}" deleted successfully!`);
                        
                        // Add activity log
                        addActivityLog('Deleted Admin', adminName, 'completed');
                    }
                    
                } else if (deleteType === 'developer_data') {
                    // Try to delete from Firebase
                    try {
                        await database.ref('developer_data/' + itemToDelete).remove();
                    } catch (error) {
                        console.warn('Could not delete developer data from database:', error);
                    }
                    
                    // Also delete from localStorage
                    const savedItems = JSON.parse(localStorage.getItem('developer_data') || '[]');
                    const filteredItems = savedItems.filter(item => item.id !== itemToDelete);
                    localStorage.setItem('developer_data', JSON.stringify(filteredItems));
                    
                    const index = developerData.findIndex(d => d.id === itemToDelete);
                    if (index !== -1) {
                        const dataTitle = developerData[index].title;
                        developerData.splice(index, 1);
                        showSuccess(`"${dataTitle}" deleted successfully!`);
                        
                        // Add activity log
                        addActivityLog('Deleted Developer Data', dataTitle, 'completed');
                    }
                }
                
                loadDashboardData();
                
                // Refresh the current section if it's visible
                if (document.getElementById('manageNoticesSection').style.display === 'block' && deleteType === 'notice') {
                    loadNoticesTable();
                } else if (document.getElementById('manageTeachersSection').style.display === 'block' && deleteType === 'teacher') {
                    loadTeachersTable();
                } else if (document.getElementById('manageStudentsSection').style.display === 'block' && deleteType === 'student') {
                    loadStudentsTable();
                } else if (document.getElementById('manageAdminsSection').style.display === 'block' && deleteType === 'admin') {
                    loadAdminsTable();
                } else if (document.getElementById('developerSection').style.display === 'block' && deleteType === 'developer_data') {
                    loadDeveloperData();
                }
                
            } catch (error) {
                showError('Failed to delete: ' + error.message);
                
                // Add failed activity log
                addActivityLog(`Failed to Delete ${deleteType}`, `ID: ${itemToDelete}`, 'failed');
            } finally {
                document.getElementById('deleteModal').style.display = 'none';
                itemToDelete = null;
                deleteType = null;
                
                confirmDeleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                confirmDeleteBtn.disabled = false;
            }
        }

        // ============================
        // SETTINGS FUNCTIONS
        // ============================
        function handleProfileImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showError('Please select an image file');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showError('Image size should be less than 5MB');
                return;
            }
            
            changeProfileBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            changeProfileBtn.disabled = true;
            
            setTimeout(() => {
                const imageUrl = URL.createObjectURL(file);
                
                updateProfileImage(adminAvatar, imageUrl);
                updateProfileImage(settingsProfileImage, imageUrl);
                
                if (currentUser) {
                    try {
                        database.ref('admins/' + currentUser.uid).update({
                            profileImage: imageUrl,
                            updatedAt: new Date().toISOString()
                        }).then(() => {
                            showSuccess('Profile picture updated successfully!');
                            
                            // Add activity log
                            addActivityLog('Updated Profile Picture', 'Changed profile image', 'completed');
                        }).catch(error => {
                            console.warn('Could not update profile in database:', error);
                            showSuccess('Profile picture updated locally!');
                            
                            // Add activity log
                            addActivityLog('Updated Profile Picture', 'Changed profile image (locally)', 'completed');
                        });
                    } catch (error) {
                        console.warn('Database update failed:', error);
                        showSuccess('Profile picture updated locally!');
                    }
                }
                
                changeProfileBtn.innerHTML = '<i class="fas fa-camera"></i> Change Profile Picture';
                changeProfileBtn.disabled = false;
            }, 1500);
        }

        async function updateProfile() {
            const name = document.getElementById('settingsName').value;
            
            if (!name) {
                showError('Please enter your name');
                return;
            }
            
            const btn = updateProfileBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            btn.disabled = true;
            
            try {
                try {
                    await database.ref('admins/' + currentUser.uid).update({
                        name: name,
                        updatedAt: new Date().toISOString()
                    });
                } catch (dbError) {
                    console.warn('Could not update profile in database:', dbError);
                }
                
                await currentUser.updateProfile({
                    displayName: name
                });
                
                currentUser.displayName = name;
                if (currentAdmin) {
                    currentAdmin.name = name;
                }
                adminName.textContent = name;
                
                showSuccess('Profile updated successfully!');
                
                // Add activity log
                addActivityLog('Updated Profile', 'Changed display name', 'completed');
                
            } catch (error) {
                showError('Failed to update profile: ' + error.message);
                
                // Add failed activity log
                addActivityLog('Failed to Update Profile', 'Could not update display name', 'failed');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('settingsNewPassword').value;
            const confirmPassword = document.getElementById('settingsConfirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('Please fill all fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showError('New passwords do not match');
                return;
            }
            
            let requirements = [];
            
            if (newPassword.length < 6) {
                requirements.push('at least 6 characters');
            }
            if (!/[a-z]/.test(newPassword)) {
                requirements.push('one lowercase letter');
            }
            if (!/[A-Z]/.test(newPassword)) {
                requirements.push('one uppercase letter');
            }
            if (!/[0-9]/.test(newPassword)) {
                requirements.push('one number');
            }
            
            if (requirements.length > 0) {
                showError('Password must contain: ' + requirements.join(', '));
                return;
            }
            
            const btn = changePasswordBtn;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
            btn.disabled = true;
            
            try {
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email, 
                    currentPassword
                );
                
                await currentUser.reauthenticateWithCredential(credential);
                await currentUser.updatePassword(newPassword);
                
                showSuccess('Password changed successfully!');
                
                document.getElementById('currentPassword').value = '';
                document.getElementById('settingsNewPassword').value = '';
                document.getElementById('settingsConfirmPassword').value = '';
                passwordRequirements.style.display = 'none';
                
                // Add activity log
                addActivityLog('Changed Password', 'Account security update', 'completed');
                
            } catch (error) {
                let errorMessage = 'Failed to change password. ';
                
                if (error.code === 'auth/wrong-password') {
                    errorMessage += 'Current password is incorrect.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage += 'New password is too weak.';
                } else if (error.code === 'auth/requires-recent-login') {
                    errorMessage += 'Please log in again and try.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage += 'Too many attempts. Please try again later.';
                } else {
                    errorMessage += error.message;
                }
                
                showError(errorMessage);
                
                // Add failed activity log
                addActivityLog('Failed to Change Password', 'Password update failed', 'failed');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ============================
        // UTILITY FUNCTIONS
        // ============================
        function loadSampleData() {
            // Sample notices
            notices = [
                {
                    id: 'notice_1',
                    title: 'Annual Sports Day Announcement',
                    content: 'We are pleased to announce that our Annual Sports Day will be held on 25th November 2023. All students are required to participate in at least one event. Teachers are requested to coordinate with the sports department.',
                    priority: 'high',
                    category: 'event',
                    recipients: { teachers: true, students: true },
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    status: 'sent',
                    sentBy: 'Admin'
                }
            ];
            
            // Sample teachers
            teachers = [];
            
            // Sample students from your data
            students = [
                {
                    id: '3wFl9ap5GUR9bMPNGvE9CSweF282',
                    fullName: 'Satish',
                    rollNumber: '56',
                    grade: '12',
                    section: 'A',
                    parentName: 'MR SURENDRA',
                    phone: '5693269568',
                    email: 'Satish123@gmail.com',
                    dateOfBirth: '12/05/2008',
                    profileImage: 'https://res.cloudinary.com/dmhyflswb/image/upload/v1766931511/teacher_app/profiles/oel1ulm8arimevpj7fh4.webp',
                    registrationDate: '2025-12-28 19:48:31',
                    status: 'approved',
                    studentId: '3wFl9ap5GUR9bMPNGvE9CSweF282',
                    teacherId: '0r2D7HH8s9f5K2j7TZ9VIQdoODP2',
                    updatedAt: '2025-12-28 20:07:39',
                    emailVerified: false
                },
                {
                    id: '5q3X3tfdwCdkFxefV3TJrs5zW8M2',
                    fullName: 'Student 2',
                    status: 'approved'
                },
                {
                    id: '8MXRQF146FObqwdnFFAAFJYz8QG3',
                    fullName: 'Student 3',
                    status: 'approved'
                },
                {
                    id: 'E4M8BT4L3PTtqFm55QtYHZVDJB03',
                    fullName: 'Student 4',
                    status: 'pending'
                }
            ];
            
            // Sample admins
            admins = [
                {
                    id: 'BJc2OteAUtXeO3ddrfsJP102iNy2',
                    name: 'VIJAY KUMAR',
                    email: 'vijaygond2024@gmail.com',
                    role: 'super_admin',
                    status: 'active',
                    profileImage: 'blob:https://swayamvarapp26-oss.github.io/f27d4ee4-3a89-464a-9e05-cb97eeeb251b',
                    createdAt: '2026-01-12T08:46:17.614Z',
                    createdBy: 'BJc2OteAUtXeO3ddrfsJP102iNy2',
                    createdByName: 'VIJAY',
                    lastLogin: '2026-01-12T16:43:25.792Z',
                    updatedAt: '2026-01-12T08:58:33.087Z'
                }
            ];
            
            // Sample developer data
            developerData = [];
            
            // Load developer data from localStorage if available
            try {
                const savedItems = JSON.parse(localStorage.getItem('developer_data') || '[]');
                if (savedItems.length > 0) {
                    developerData = savedItems;
                }
            } catch (error) {
                console.log('No developer data in localStorage');
            }
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function clearNoticeForm() {
            document.getElementById('noticeTitle').value = '';
            document.getElementById('noticeContent').value = '';
            document.getElementById('noticePriority').value = 'low';
            document.getElementById('noticeCategory').value = 'general';
            document.getElementById('sendToTeachers').checked = true;
            document.getElementById('sendToStudents').checked = true;
        }

        function clearLoginForm() {
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showSuccess(message) {
            successText.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
